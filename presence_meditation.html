<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>presence</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dawn-start: #f8f9fa;
            --dawn-mid: #e9ecef;
            --dawn-end: #dee2e6;
            --text-whisper: #6c757d;
            --text-soft: #495057;
            --text-present: #212529;
            --breath-in: rgba(139, 152, 165, 0.1);
            --breath-out: rgba(139, 152, 165, 0.05);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', sans-serif;
            background: linear-gradient(180deg, var(--dawn-start) 0%, var(--dawn-mid) 50%, var(--dawn-end) 100%);
            background-size: 400% 400%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-soft);
            overflow-x: hidden;
            animation: skyShift 180s ease-in-out infinite;
            padding: 20px;
        }

        @keyframes skyShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .container {
            width: 100%;
            max-width: 480px;
            text-align: center;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 300;
            letter-spacing: 4px;
            text-transform: lowercase;
            color: var(--text-soft);
            margin-bottom: 30px;
        }

        .subtitle {
            font-size: 0.85rem;
            font-weight: 300;
            line-height: 1.8;
            color: var(--text-whisper);
            margin-bottom: 60px;
        }

        .breath-circle {
            width: 220px;
            height: 220px;
            border-radius: 50%;
            background: var(--breath-out);
            margin: 0 auto 40px auto;
            transition: transform 4s cubic-bezier(0.4, 0, 0.2, 1), background 4s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px solid rgba(139, 152, 165, 0.3);
            position: relative;
            cursor: pointer;
        }

        .breath-circle.inhale {
            transform: scale(1.35);
            background: var(--breath-in);
        }

        .breath-count {
            font-size: 2rem;
            color: var(--text-soft);
            letter-spacing: 2px;
            font-weight: 200;
            margin-bottom: 8px;
        }

        .breath-label {
            font-size: 0.75rem;
            color: var(--text-whisper);
            letter-spacing: 3px;
            text-transform: lowercase;
            font-weight: 300;
        }

        .breath-description {
            font-size: 0.75rem;
            color: var(--text-whisper);
            line-height: 1.6;
            margin: 15px 0 5px 0;
            font-weight: 300;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .timer-display {
            font-size: 1.8rem;
            color: var(--text-soft);
            letter-spacing: 4px;
            margin: 30px 0;
            font-weight: 200;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0 40px 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            font-size: 0.75rem;
            color: var(--text-soft);
            background: rgba(255, 255, 255, 0.4);
            border: 2px solid rgba(139, 152, 165, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
            text-transform: lowercase;
            font-weight: 400;
            font-family: inherit;
        }

        .nav-btn.active {
            background: rgba(139, 152, 165, 0.35);
            border-color: var(--text-soft);
            color: var(--text-present);
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
            min-height: 300px;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .button-controls {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 152, 165, 0.15);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .button-group-label {
            font-size: 0.65rem;
            color: var(--text-whisper);
            letter-spacing: 1.5px;
            text-transform: lowercase;
            display: block;
            margin-bottom: 10px;
            text-align: left;
        }

        .button-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .choice-btn {
            padding: 10px 20px;
            font-size: 0.75rem;
            color: var(--text-soft);
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(139, 152, 165, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: lowercase;
        }

        .choice-btn.active {
            background: rgba(139, 152, 165, 0.3);
            border-color: var(--text-soft);
        }

        .preset-btn {
            padding: 8px 16px;
            font-size: 0.7rem;
            color: var(--text-soft);
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(139, 152, 165, 0.15);
            border-radius: 4px;
            cursor: pointer;
            text-transform: lowercase;
            margin: 4px;
        }

        .sangha-map {
            width: 100%;
            height: 180px;
            background: rgba(139, 152, 165, 0.05);
            border-radius: 6px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
        }

        .meditator-dot {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--text-whisper);
            border-radius: 50%;
            opacity: 0.5;
        }

        .koan-text, .zen-response {
            font-size: 1rem;
            color: var(--text-present);
            line-height: 1.9;
            font-style: italic;
            margin: 30px 0;
            font-weight: 300;
        }

        .koan-journal, .zen-input {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(139, 152, 165, 0.15);
            border-radius: 6px;
            font-family: inherit;
            color: var(--text-soft);
        }

        .stats-hidden {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 0.65rem;
            color: var(--text-whisper);
            opacity: 0.4;
            letter-spacing: 1px;
        }

        select {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(139, 152, 165, 0.2);
            border-radius: 6px;
            font-family: inherit;
            color: var(--text-soft);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="stats-hidden">
        total hours of presence: <span id="totalHours">0.00</span>
    </div>

    <div class="container">
        <div class="title">presence</div>
        <div class="subtitle">you have arrived at this moment. there is nowhere else to be.</div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showScreen('breathe', this)">breathe</button>
            <button class="nav-btn" onclick="showScreen('sangha', this)">sangha</button>
            <button class="nav-btn" onclick="showScreen('reflect', this)">reflect</button>
            <button class="nav-btn" onclick="showScreen('ask', this)">ask</button>
        </div>

        <div class="screen active" id="breatheScreen">
            <div class="button-controls">
                <div class="button-group-label">1. choose your path</div>
                <div class="button-row" id="pathRow">
                    <button class="choice-btn active" onclick="setPath('mindfulness', this)">üåø mindfulness</button>
                    <button class="choice-btn" onclick="setPath('zen', this)">ü™∑ zen</button>
                    <button class="choice-btn" onclick="setPath('foundational', this)">üå¨Ô∏è focus</button>
                </div>
                <div class="button-group-label" style="margin-top:20px;">2. technique</div>
                <select id="techniqueSelect" onchange="updateTechnique()"></select>
            </div>

            <div class="breath-circle" id="breathCircle" onclick="toggleBreathing()">
                <div class="breath-count" id="breathCount"></div>
                <div class="breath-label" id="breathLabel">tap to begin</div>
            </div>

            <div class="breath-description" id="breathDescription">Select a path to begin.</div>
            <div class="timer-display" id="timerDisplay">00:00</div>

            <div class="preset-group">
                <button class="preset-btn" onclick="setTimer(5)">5 min</button>
                <button class="preset-btn" onclick="setTimer(10)">10 min</button>
                <button class="preset-btn" onclick="setTimer(20)">20 min</button>
                <button class="preset-btn" onclick="setTimer(0)">reset</button>
            </div>
        </div>

        <div class="screen" id="sanghaScreen">
            <div class="subtitle">you are not alone in this practice.</div>
            <div class="sangha-map" id="sanghaMap"></div>
            <div id="sanghaCount" style="font-size: 0.7rem; color: var(--text-whisper);">‚Äî beings currently sitting</div>
        </div>

        <div class="screen" id="reflectScreen">
            <div class="koan-text" id="koanText"></div>
            <textarea class="koan-journal" placeholder="there is no answer. only sitting with the question..."></textarea>
            <button class="nav-btn" style="margin-top:20px;" onclick="newKoan()">new koan</button>
        </div>

        <div class="screen" id="askScreen">
            <div class="subtitle">ask a question of the master.</div>
            <input type="text" class="zen-input" id="zenInput" placeholder="what is the truth?">
            <button class="nav-btn" style="margin-top:20px;" onclick="askMaster()">ask</button>
            <div class="zen-response" id="zenResponse"></div>
        </div>
    </div>

    <script>
        // --- Data Library ---
        const library = {
            mindfulness: [
                { name: 'Vipassana', inhale: 4, hold: 0, exhale: 4, pause: 0, desc: 'Simply observe the breath as it enters and leaves.' },
                { name: 'Box Breathing', inhale: 4, hold: 4, exhale: 4, pause: 4, desc: 'Square breathing for mental clarity.' }
            ],
            zen: [
                { name: 'Counting Breath', inhale: 4, hold: 0, exhale: 8, pause: 0, desc: 'Count to ten, then start again.' }
            ],
            foundational: [
                { name: '4-7-8 Relax', inhale: 4, hold: 7, exhale: 8, pause: 0, desc: 'A natural tranquilizer for the nervous system.' }
            ]
        };

        const koans = [
            "What is the sound of one hand clapping?",
            "What was your face before your parents were born?",
            "Does a dog have Buddha-nature?",
            "The obstacle is the path.",
            "If you meet the Buddha on the road, kill him."
        ];

        // --- State ---
        let state = {
            isBreathing: false,
            currentPath: 'mindfulness',
            currentTech: null,
            totalSeconds: parseFloat(localStorage.getItem('presenceSeconds')) || 0,
            timerLeft: 0,
            timerId: null
        };

        // --- Core Functions ---
        function showScreen(id, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id + 'Screen').classList.add('active');
            btn.classList.add('active');
            
            if(id === 'sangha') initSangha();
            if(id === 'reflect') newKoan();
        }

        function setPath(path, btn) {
            state.currentPath = path;
            document.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const select = document.getElementById('techniqueSelect');
            select.innerHTML = '';
            library[path].forEach((t, i) => {
                const opt = document.createElement('option');
                opt.value = i;
                opt.innerText = t.name;
                select.appendChild(opt);
            });
            updateTechnique();
        }

        function updateTechnique() {
            const idx = document.getElementById('techniqueSelect').value;
            state.currentTech = library[state.currentPath][idx];
            document.getElementById('breathDescription').innerText = state.currentTech.desc;
        }

        async function toggleBreathing() {
            state.isBreathing = !state.isBreathing;
            const circle = document.getElementById('breathCircle');
            const label = document.getElementById('breathLabel');

            if (!state.isBreathing) {
                circle.classList.remove('inhale');
                label.innerText = 'tap to begin';
                return;
            }

            while (state.isBreathing) {
                const t = state.currentTech;
                
                label.innerText = 'inhale';
                circle.style.transitionDuration = t.inhale + 's';
                circle.classList.add('inhale');
                await sleep(t.inhale * 1000);
                if(!state.isBreathing) break;

                if(t.hold > 0) {
                    label.innerText = 'hold';
                    await sleep(t.hold * 1000);
                }
                if(!state.isBreathing) break;

                label.innerText = 'exhale';
                circle.style.transitionDuration = t.exhale + 's';
                circle.classList.remove('inhale');
                await sleep(t.exhale * 1000);
                if(!state.isBreathing) break;

                if(t.pause > 0) {
                    label.innerText = 'pause';
                    await sleep(t.pause * 1000);
                }
            }
        }

        function setTimer(mins) {
            clearInterval(state.timerId);
            if (mins === 0) {
                document.getElementById('timerDisplay').innerText = "00:00";
                return;
            }
            state.timerLeft = mins * 60;
            state.timerId = setInterval(() => {
                state.timerLeft--;
                const m = Math.floor(state.timerLeft / 60);
                const s = state.timerLeft % 60;
                document.getElementById('timerDisplay').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                
                // Track total time
                state.totalSeconds += 1;
                document.getElementById('totalHours').innerText = (state.totalSeconds / 3600).toFixed(2);
                localStorage.setItem('presenceSeconds', state.totalSeconds);

                if (state.timerLeft <= 0) clearInterval(state.timerId);
            }, 1000);
        }

        function initSangha() {
            const map = document.getElementById('sanghaMap');
            map.innerHTML = '';
            for(let i=0; i<30; i++) {
                const dot = document.createElement('div');
                dot.className = 'meditator-dot';
                dot.style.left = Math.random() * 100 + '%';
                dot.style.top = Math.random() * 100 + '%';
                map.appendChild(dot);
            }
            document.getElementById('sanghaCount').innerText = `${Math.floor(Math.random()*400 + 1200)} beings currently sitting`;
        }

        function newKoan() {
            document.getElementById('koanText').innerText = koans[Math.floor(Math.random() * koans.length)];
        }

        function askMaster() {
            const answers = [
                "The tea is getting cold.",
                "Why do you look for the moon in the pond?",
                "When you are hungry, eat. When you are tired, sleep.",
                "Look at the one who is asking.",
                "Silence is the answer."
            ];
            const response = document.getElementById('zenResponse');
            response.style.opacity = 0;
            setTimeout(() => {
                response.innerText = answers[Math.floor(Math.random() * answers.length)];
                response.style.opacity = 1;
            }, 300);
        }

        const sleep = ms => new Promise(res => setTimeout(res, ms));

        // Start
        setPath('mindfulness', document.querySelector('.choice-btn'));
        document.getElementById('totalHours').innerText = (state.totalSeconds / 3600).toFixed(2);
    </script>
</body>
</html>
