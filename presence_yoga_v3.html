<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presence • Drishti AI Studio</title>
    
    <script src="pose-database.js"></script>
    <script src="yoga-library-with-variations.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@300;400;600&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #334155; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        
        .stats-box { 
            background-color: #f0f4ff; 
            border: 1px solid #dbeafe; 
            border-radius: 12px; 
            padding: 24px;
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; background: #e2e8f0; border-radius: 3px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #2563eb; cursor: pointer; margin-top: -6px; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [library, setLibrary] = useState({});
            const [search, setSearch] = useState('');
            const [seq, setSeq] = useState({ flow: [] });
            const [viewMode, setViewMode] = useState('structural');
            const [activeLevel, setActiveLevel] = useState('Beginner');
            const [duration, setDuration] = useState(60);
            const [selectedStyle, setSelectedStyle] = useState('Drishti Yoga');

            const yogaStyles = [
                "Drishti Yoga", "Hatha", "Ashtanga", "Iyengar", "Kundalini", "Sivananda", 
                "Vinyasa Flow", "Power Yoga", "Rocket Yoga", "Jivamukti", 
                "Baptiste Power", "Yin Yoga", "Restorative", "Gentle Yoga", 
                "Chair Yoga", "Therapeutic", "Somatic Yoga", "Bikram", 
                "Hot Vinyasa", "Hot Power", "Inferno Hot Pilates"
            ];

            const styleDescriptions = {
                "Drishti Yoga": "Focused gaze (Drishti) to cultivate single-pointed attention and alignment.",
                "Hatha": "Classical yoga emphasizing alignment, balance, and controlled breath.",
                "Vinyasa Flow": "Dynamic movement connecting breath with continuous posture transitions.",
                "Yin Yoga": "Meditative floor-based practice targeting deep connective tissues."
            };

            useEffect(() => {
                const syncData = () => {
                    const data = window.allPoses || window.yogaLibraryVariations || [];
                    if (data.length > 0) {
                        const dict = {};
                        data.forEach(p => { if(p.id) dict[p.id] = p; });
                        setLibrary(dict);
                    }
                };
                syncData();
            }, []);

            // Sidebar Filtering (Parents only, subcategories handled in map)
            const mainList = Object.values(library).filter(p => 
                !p.isVariation && !p.parentPose &&
                p.name?.toLowerCase().includes(search.toLowerCase())
            );

            const totalPoses = seq.flow.length;
            const estSeconds = seq.flow.reduce((acc, id) => acc + (library[id]?.duration || 0), 0);
            const estMinutes = Math.round(estSeconds / 60) || (totalPoses * 5);

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    {/* Header */}
                    <header className="p-6 border-b flex items-center gap-4 bg-white z-10">
                        <div className="w-12 h-12 bg-[#002b1d] rounded-full flex items-center justify-center text-white font-serif text-2xl font-bold shadow-sm">P</div>
                        <div>
                            <h1 className="font-serif text-4xl text-[#002b1d] leading-none">Presence Yoga</h1>
                            <p className="text-[10px] uppercase tracking-[0.3em] text-emerald-600 mt-1 font-bold">Drishti Sequence Studio</p>
                        </div>
                    </header>

                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar: AI Controls & Subcategory Library */}
                        <aside className="w-[400px] border-r overflow-y-auto bg-white">
                            <div className="p-8 space-y-8">
                                <section className="space-y-6">
                                    <h3 className="text-[11px] font-bold tracking-[0.2em] text-slate-400 uppercase border-b pb-2">AI Sequencing</h3>
                                    
                                    <div className="space-y-2">
                                        <label className="text-sm text-slate-600 font-semibold">Category</label>
                                        <select className="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 text-slate-700 outline-none">
                                            <option>All Categories</option>
                                        </select>
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-sm text-slate-600 font-semibold">Style</label>
                                        <select 
                                            className="w-full p-3 border border-slate-200 rounded-xl bg-slate-50 text-slate-700 outline-none"
                                            value={selectedStyle}
                                            onChange={(e) => setSelectedStyle(e.target.value)}
                                        >
                                            {yogaStyles.map(s => <option key={s} value={s}>{s}</option>)}
                                        </select>
                                        <p className="text-[11px] italic text-slate-400">{styleDescriptions[selectedStyle] || "A transformative practice for body and mind."}</p>
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-sm text-slate-600 font-semibold">Level</label>
                                        <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200">
                                            {['Beginner', 'Intermediate', 'Advanced'].map(lvl => (
                                                <button 
                                                    key={lvl}
                                                    onClick={() => setActiveLevel(lvl)}
                                                    className={`flex-1 py-2 text-[10px] rounded-lg transition-all ${activeLevel === lvl ? 'bg-[#e2e8f0] text-slate-900 font-bold shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}
                                                >
                                                    {lvl}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="space-y-4">
                                        <label className="text-sm text-slate-600 font-semibold flex justify-between">
                                            <span>Minutes</span>
                                            <span className="text-blue-600 font-bold">{duration} min</span>
                                        </label>
                                        <input 
                                            type="range" min="15" max="120" step="5" value={duration}
                                            onChange={(e) => setDuration(e.target.value)}
                                        />
                                        <div className="flex justify-between text-[10px] text-slate-400 font-bold">
                                            <span>15</span>
                                            <span>120</span>
                                        </div>
                                    </div>

                                    <button className="w-full py-4 bg-[#002b1d] text-white rounded-2xl font-bold flex items-center justify-center gap-2 shadow-lg hover:bg-black transition-all">
                                        ✨ Generate Sequence
                                    </button>
                                </section>

                                <hr className="border-slate-100" />

                                <section className="space-y-5 pb-10">
                                    <h3 className="text-[11px] font-bold tracking-[0.2em] text-slate-400 uppercase">Pose Library</h3>
                                    <input 
                                        type="text" placeholder="Search poses & variations..." 
                                        className="w-full p-2 border-b border-slate-100 outline-none text-sm italic italic"
                                        onChange={(e) => setSearch(e.target.value)}
                                    />
                                    <div className="space-y-6">
                                        {mainList.map(p => (
                                            <div key={p.id} className="space-y-2">
                                                <div 
                                                    onClick={() => setSeq(s => ({...s, flow: [...s.flow, p.id]}))}
                                                    className="flex justify-between items-center cursor-pointer hover:text-blue-600 group"
                                                >
                                                    <span className="text-sm font-semibold text-slate-700">{p.name}</span>
                                                    <span className="text-slate-200 group-hover:text-blue-500 font-bold">+</span>
                                                </div>
                                                {/* Subcategories (Variations) */}
                                                {p.variations && p.variations.map(v => (
                                                    <div 
                                                        key={v.id} 
                                                        onClick={() => setSeq(s => ({...s, flow: [...s.flow, v.id]}))}
                                                        className="ml-4 pl-3 border-l border-slate-100 text-[11px] text-slate-400 cursor-pointer flex justify-between hover:text-blue-500 hover:border-blue-200 transition-all group"
                                                    >
                                                        <span>• {v.name}</span>
                                                        <span className="opacity-0 group-hover:opacity-100">+</span>
                                                    </div>
                                                ))}
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>
                        </aside>

                        {/* Main Stage: Sequence Designer */}
                        <main className="flex-1 overflow-y-auto p-12 bg-white">
                            <div className="max-w-3xl mx-auto space-y-10">
                                <div className="flex justify-between items-end border-b pb-6">
                                    <h2 className="font-serif text-4xl text-slate-800 font-bold tracking-tight">Sequence Flow</h2>
                                    <div className="flex bg-slate-100 p-1 rounded-xl border border-slate-200">
                                        {['structural', 'teaching'].map(mode => (
                                            <button 
                                                key={mode}
                                                onClick={() => setViewMode(mode)}
                                                className={`px-5 py-2 text-xs rounded-lg transition-all capitalize ${viewMode === mode ? 'bg-white shadow-sm font-bold text-slate-900' : 'text-slate-400'}`}
                                            >
                                                {mode === 'teaching' ? 'Teaching Script' : mode}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Blue Stats Box */}
                                <div className="stats-box space-y-3">
                                    <h4 className="text-[10px] font-bold tracking-[0.2em] text-blue-800 uppercase">Sequence Stats</h4>
                                    <div className="flex justify-between text-sm border-b border-blue-100 pb-2">
                                        <span className="text-blue-600">Total Poses:</span>
                                        <span className="font-bold text-blue-900">{totalPoses}</span>
                                    </div>
                                    <div className="flex justify-between text-sm border-b border-blue-100 pb-2">
                                        <span className="text-blue-600">Estimated Duration:</span>
                                        <span className="font-bold text-blue-900">{estMinutes} min</span>
                                    </div>
                                    <div className="flex justify-between text-sm">
                                        <span className="text-blue-600">Difficulty Level:</span>
                                        <span className="font-bold text-blue-900">{activeLevel}</span>
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    {seq.flow.map((id, i) => (
                                        <div key={i} className="flex items-start gap-8 p-6 rounded-2xl hover:bg-slate-50 transition-all group relative border-b border-slate-50">
                                            <span className="font-serif italic text-slate-200 text-3xl mt-1">{String(i + 1).padStart(2, '0')}</span>
                                            <div className="flex-1">
                                                <h3 className="font-bold text-slate-800 text-xl">{library[id]?.name}</h3>
                                                <div className="flex gap-4 mt-1 text-[10px] font-bold uppercase tracking-wider text-slate-400">
                                                    <span>{library[id]?.level}</span>
                                                    <span className="text-blue-500">{library[id]?.duration}s Hold</span>
                                                </div>
                                                {viewMode === 'teaching' && (
                                                    <div className="mt-4 p-4 bg-white border border-slate-100 rounded-xl text-sm text-slate-500 leading-relaxed italic border-l-4 border-l-blue-400">
                                                        "Gently settle your gaze. In {library[id]?.name}, focus on the drishti point to anchor your presence and allow the breath to move through the posture..."
                                                    </div>
                                                )}
                                            </div>
                                            <button 
                                                onClick={() => setSeq(s => ({...s, flow: s.flow.filter((_, idx) => idx !== i)}))}
                                                className="opacity-0 group-hover:opacity-100 p-2 text-slate-300 hover:text-red-500 transition-all"
                                            >✕</button>
                                        </div>
                                    ))}
                                    {seq.flow.length === 0 && (
                                        <div className="py-32 text-center border-2 border-dashed border-slate-100 rounded-[3rem]">
                                            <p className="font-serif text-2xl text-slate-300 italic">Select poses to begin your flow</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
