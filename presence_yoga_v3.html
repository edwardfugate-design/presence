<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presence ‚Ä¢ Drishti AI Studio</title>
    
    <script src="pose-database.js"></script>
    <script src="yoga-library-with-variations.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; color: #334155; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .stats-box { background-color: #f0f4ff; border: 1px solid #dbeafe; border-radius: 12px; }
        
        .method-btn { transition: all 0.2s ease; border: 1px solid #e2e8f0; }
        .method-btn.active { background-color: #002b1d; color: white; border-color: #002b1d; font-weight: 600; }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #002b1d; cursor: pointer; margin-top: -6px; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        /* Thin scrollbar for the library */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [library, setLibrary] = useState({});
            const [search, setSearch] = useState('');
            const [seq, setSeq] = useState({ flow: [] });
            const [activeLevel, setActiveLevel] = useState('Beginner');
            const [selectedCategory, setSelectedCategory] = useState('All Categories');
            const [selectedStyle, setSelectedStyle] = useState('Drishti Yoga');
            const [aiDuration, setAiDuration] = useState(60);

            const yogaStyles = [
                "Drishti Yoga", "Hatha", "Ashtanga", "Iyengar", "Kundalini", "Sivananda", 
                "Vinyasa Flow", "Power Yoga", "Rocket Yoga", "Jivamukti", 
                "Baptiste Power", "Yin Yoga", "Restorative", "Gentle Yoga", 
                "Chair Yoga", "Therapeutic", "Somatic Yoga", "Bikram", 
                "Hot Vinyasa", "Hot Power", "Inferno Hot Pilates"
            ];

            const categories = ["All Categories", "Standing", "Seated", "Floor", "Core", "Backbends", "Inversions", "Restorative"];

            const drishtiPoints = [
                { name: "Nasagrai", focus: "Tip of the Nose" },
                { name: "Ajna", focus: "Third Eye" },
                { name: "Nabi Chakra", focus: "Navel" },
                { name: "Hastagrai", focus: "Hand" },
                { name: "Padayoragrai", focus: "Toes" },
                { name: "Parsva", focus: "Sideways" },
                { name: "Angusthamadhye", focus: "Thumbs" },
                { name: "Urdhva", focus: "Upward" }
            ];

            useEffect(() => {
                const syncData = () => {
                    const data = window.allPoses || window.yogaLibraryVariations || [];
                    if (data.length > 0) {
                        const dict = {};
                        data.forEach(p => { if(p.id) dict[p.id] = p; });
                        setLibrary(dict);
                    }
                };
                syncData();
            }, []);

            const addPose = (id) => {
                setSeq(s => ({
                    ...s, 
                    flow: [...s.flow, { id, holdType: 'breath', holdVal: 5, drishti: "Nasagrai" }] 
                }));
            };

            const updateItem = (index, field, value) => {
                const newFlow = [...seq.flow];
                newFlow[index][field] = value;
                setSeq({...seq, flow: newFlow});
            };

            const filteredList = Object.values(library).filter(p => {
                const matchesSearch = p.name?.toLowerCase().includes(search.toLowerCase());
                const matchesLevel = p.level === activeLevel;
                const matchesCategory = selectedCategory === 'All Categories' || 
                                       (p.category && p.category.toLowerCase() === selectedCategory.toLowerCase());
                return matchesSearch && matchesLevel && matchesCategory && !p.isVariation && !p.parentPose;
            });

            const estMinutes = Math.round(seq.flow.reduce((acc, item) => {
                return acc + (item.holdType === 'breath' ? item.holdVal * 6 : parseInt(item.holdVal));
            }, 0) / 60);

            return (
                <div className="flex flex-col h-screen overflow-hidden">
                    <header className="p-6 border-b flex items-center justify-between bg-white z-10 shadow-sm">
                        <div className="flex items-center gap-4">
                            <div className="w-10 h-10 bg-[#002b1d] rounded-full flex items-center justify-center text-white font-serif text-xl font-bold">P</div>
                            <h1 className="font-serif text-3xl text-[#002b1d]">Presence Yoga</h1>
                        </div>
                        <div className="text-[10px] uppercase tracking-[0.3em] text-slate-400 font-bold">Drishti Studio ‚Ä¢ Vault V3</div>
                    </header>

                    <div className="flex flex-1 overflow-hidden">
                        {/* FULL SIDEBAR RESTORED */}
                        <aside className="w-[360px] border-r overflow-y-auto bg-white p-7 space-y-7 custom-scroll">
                            <section className="space-y-5">
                                <h3 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest border-b pb-2">AI Sequencing</h3>
                                
                                <div className="space-y-2">
                                    <label className="text-[11px] font-semibold text-slate-500 uppercase">Style</label>
                                    <select className="w-full p-2.5 border rounded-xl bg-slate-50 text-sm outline-none" value={selectedStyle} onChange={e => setSelectedStyle(e.target.value)}>
                                        {yogaStyles.map(s => <option key={s} value={s}>{s}</option>)}
                                    </select>
                                </div>

                                <div className="space-y-2">
                                    <label className="text-[11px] font-semibold text-slate-500 uppercase">Level</label>
                                    <div className="flex bg-slate-100 p-1 rounded-xl border">
                                        {['Beginner', 'Intermediate', 'Advanced'].map(lvl => (
                                            <button key={lvl} onClick={() => setActiveLevel(lvl)} className={`flex-1 py-1.5 text-[10px] rounded-lg transition-all ${activeLevel === lvl ? 'bg-white shadow-sm text-slate-900 font-bold' : 'text-slate-400'}`}>{lvl}</button>
                                        ))}
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    <div className="flex justify-between text-[11px] font-bold">
                                        <label className="text-slate-500 uppercase tracking-tighter">Class Duration</label>
                                        <span className="text-emerald-700">{aiDuration} min</span>
                                    </div>
                                    <input type="range" min="15" max="120" step="5" value={aiDuration} onChange={e => setAiDuration(e.target.value)} className="w-full" />
                                </div>

                                <button className="w-full py-3 bg-[#002b1d] text-white rounded-xl text-xs font-bold shadow-md hover:bg-black transition-all">
                                    ‚ú® Generate AI Flow
                                </button>
                            </section>

                            <hr className="border-slate-100" />

                            <section className="space-y-4">
                                <h3 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest border-b pb-2">Pose Library</h3>
                                
                                <div className="space-y-2">
                                    <label className="text-[11px] font-semibold text-slate-500 uppercase">Filter Category</label>
                                    <select className="w-full p-2.5 border rounded-xl bg-slate-50 text-sm outline-none" value={selectedCategory} onChange={e => setSelectedCategory(e.target.value)}>
                                        {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                    </select>
                                </div>

                                <input type="text" placeholder="Search poses..." className="w-full p-2 text-sm italic outline-none border-b" onChange={e => setSearch(e.target.value)} />
                                
                                <div className="space-y-3 pt-2">
                                    {filteredList.map(p => (
                                        <div key={p.id} className="space-y-2">
                                            <div onClick={() => addPose(p.id)} className="flex justify-between items-center cursor-pointer hover:text-emerald-600 transition-colors">
                                                <span className="text-sm font-medium text-slate-700">{p.name}</span>
                                                <span className="text-slate-200 font-bold">+</span>
                                            </div>
                                            {p.variations && p.variations.map(v => (
                                                <div key={v.id} onClick={() => addPose(v.id)} className="ml-4 pl-3 border-l text-[11px] text-slate-400 cursor-pointer flex justify-between hover:text-emerald-500">
                                                    <span>‚Ä¢ {v.name}</span>
                                                    <span>+</span>
                                                </div>
                                            ))}
                                        </div>
                                    ))}
                                </div>
                            </section>
                        </aside>

                        {/* FLOW DESIGNER */}
                        <main className="flex-1 overflow-y-auto p-12 bg-[#fafafa]">
                            <div className="max-w-3xl mx-auto space-y-10">
                                <div className="flex justify-between items-center">
                                    <h2 className="font-serif text-4xl text-slate-800 font-bold">Sequence Flow</h2>
                                    <div className="stats-box px-6 py-3 text-center">
                                        <p className="text-[9px] font-bold text-blue-400 uppercase">Estimated Total</p>
                                        <p className="text-xl font-serif font-bold text-blue-900">{estMinutes} min</p>
                                    </div>
                                </div>

                                <div className="space-y-8">
                                    {seq.flow.map((item, i) => (
                                        <div key={i} className="bg-white rounded-[2rem] p-8 shadow-sm border border-slate-200 space-y-8 group transition-all hover:shadow-md relative">
                                            <div className="flex justify-between items-center">
                                                <div className="flex items-center gap-4">
                                                    <span className="text-slate-300 font-serif italic text-2xl">{i + 1}.</span>
                                                    <h3 className="font-serif text-3xl text-slate-800">{library[item.id]?.name}</h3>
                                                </div>
                                                <button onClick={() => setSeq(s => ({...s, flow: s.flow.filter((_, idx) => idx !== i)}))} className="text-slate-200 hover:text-red-400 transition-colors">‚úï</button>
                                            </div>

                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-10">
                                                {/* SEPARATE BUTTONS FOR METHOD */}
                                                <div className="space-y-4">
                                                    <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Hold Method</label>
                                                    <div className="flex gap-2">
                                                        <button 
                                                            onClick={() => updateItem(i, 'holdType', 'breath')}
                                                            className={`flex-1 py-3 rounded-xl text-xs method-btn ${item.holdType === 'breath' ? 'active shadow-lg shadow-emerald-100' : 'bg-white text-slate-400'}`}
                                                        >
                                                            üå¨Ô∏è Breath Count
                                                        </button>
                                                        <button 
                                                            onClick={() => updateItem(i, 'holdType', 'time')}
                                                            className={`flex-1 py-3 rounded-xl text-xs method-btn ${item.holdType === 'time' ? 'active shadow-lg shadow-emerald-100' : 'bg-white text-slate-400'}`}
                                                        >
                                                            ‚è±Ô∏è Timed Hold
                                                        </button>
                                                    </div>
                                                </div>

                                                <div className="space-y-4">
                                                    <div className="flex justify-between items-center text-[10px] font-bold uppercase tracking-widest">
                                                        <label className="text-slate-400">Duration</label>
                                                        <span className="text-emerald-700">{item.holdVal} {item.holdType === 'breath' ? 'Breaths' : 'Sec'}</span>
                                                    </div>
                                                    <input 
                                                        type="range" 
                                                        min={item.holdType === 'breath' ? "1" : "5"} 
                                                        max={item.holdType === 'breath' ? "20" : "180"} 
                                                        step={item.holdType === 'breath' ? "1" : "5"} 
                                                        value={item.holdVal} 
                                                        onChange={e => updateItem(i, 'holdVal', e.target.value)}
                                                        className="w-full"
                                                    />
                                                </div>
                                            </div>

                                            <div className="pt-6 border-t border-slate-50 flex items-center justify-between gap-8">
                                                <div className="flex-1 space-y-2">
                                                    <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Gaze (Drishti)</label>
                                                    <select 
                                                        className="w-full p-2 border-b border-slate-100 bg-transparent text-sm text-blue-800 font-medium outline-none"
                                                        value={item.drishti}
                                                        onChange={e => updateItem(i, 'drishti', e.target.value)}
                                                    >
                                                        {drishtiPoints.map(d => <option key={d.name} value={d.name}>{d.name} ‚Äî {d.focus}</option>)}
                                                    </select>
                                                </div>
                                                <div className="flex-1 bg-slate-50 p-4 rounded-xl text-[11px] text-slate-500 italic">
                                                    "Fix your gaze on the <strong>{drishtiPoints.find(d => d.name === item.drishti)?.focus}</strong> while holding for {item.holdVal} {item.holdType === 'breath' ? 'breaths' : 'seconds'}."
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
