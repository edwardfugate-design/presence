<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Presence Yoga - Studio</title>
  
  <script src="presence-content-manager.js"></script>
  <script src="presence-monitoring.js"></script>
  <script src="presence-auto-integrate.js"></script>
  <script src="yoga-library-with-variations.js"></script>
  <script src="pose-database.js"></script>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&display=swap" rel="stylesheet">
  
  <style>
    * { font-family: 'Cormorant Garamond', serif; }
    .custom-scrollbar::-webkit-scrollbar { width: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
  </style>
</head>
<body class="bg-[#f8f9fa]">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const Icons = {
      Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5v14M5 12h14"/></svg>,
      X: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18M6 6l12 12"/></svg>,
      Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
      Moon: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
      Sun: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M2 12h2"/><path d="M20 12h2"/></svg>
    };

    const PresenceYoga = () => {
      const [theme, setTheme] = useState('light');
      const [search, setSearch] = useState('');
      const [sequence, setSequence] = useState({ Warmup: [], Standing: [], Peak: [], CoolDown: [] });
      const [dataReady, setDataReady] = useState(false);

      // Check if external data is loaded
      useEffect(() => {
        const checkData = setInterval(() => {
          if (window.yogaLibrary || window.poseDatabase) {
            setDataReady(true);
            clearInterval(checkData);
          }
        }, 500);
        return () => clearInterval(checkData);
      }, []);

      const library = window.yogaLibrary || { categories: [] };

      const addPose = (section, pose) => {
        setSequence(prev => ({ ...prev, [section]: [...prev[section], { ...pose, id: Date.now() }] }));
      };

      if (!dataReady) {
        return (
          <div className="h-screen flex items-center justify-center bg-[#f8f9fa]">
            <div className="text-center">
              <div className="animate-pulse text-2xl font-light text-slate-400">centering studio...</div>
              <div className="text-xs text-slate-300 mt-2">checking library files</div>
            </div>
          </div>
        );
      }

      return (
        <div className={`min-h-screen ${theme === 'dark' ? 'bg-[#0f172a] text-white' : 'bg-[#f8f9fa] text-slate-900'}`}>
          <nav className="p-6 flex justify-between items-center border-b border-slate-200/50">
            <h1 className="text-2xl font-light">presence <span className="text-indigo-500 font-semibold">studio</span></h1>
            <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')} className="p-2 bg-white/10 rounded-full">
              {theme === 'light' ? <Icons.Moon /> : <Icons.Sun />}
            </button>
          </nav>

          <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8 p-6">
            <main className="lg:col-span-8 space-y-8">
              <div className="relative">
                <div className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"><Icons.Search /></div>
                <input 
                  onChange={(e) => setSearch(e.target.value)}
                  placeholder="Search poses..." 
                  className="w-full pl-12 pr-4 py-4 rounded-2xl border border-slate-200 outline-none bg-white text-black"
                />
              </div>

              {library.categories.map(cat => (
                <div key={cat.name}>
                  <h3 className="text-sm uppercase tracking-widest text-indigo-500 mb-4">{cat.name}</h3>
                  <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    {cat.poses.filter(p => p.name.toLowerCase().includes(search.toLowerCase())).map(pose => (
                      <div key={pose.name} className="bg-white p-4 rounded-2xl border border-slate-100 relative group shadow-sm">
                        <p className="text-sm font-medium text-slate-800">{pose.name}</p>
                        <button 
                          onClick={() => addPose('Warmup', pose)}
                          className="absolute top-2 right-2 p-1 bg-indigo-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                        >
                          <Icons.Plus />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </main>

            <aside className="lg:col-span-4">
              <div className="bg-white p-6 rounded-3xl border border-slate-200 sticky top-10 shadow-sm">
                <h2 className="text-lg font-medium text-slate-800 mb-6">Your Sequence</h2>
                {Object.entries(sequence).map(([section, poses]) => (
                  <div key={section} className="mb-4 border-l-2 border-slate-100 pl-4">
                    <p className="text-[10px] uppercase text-slate-400 mb-2">{section}</p>
                    {poses.map(p => (
                      <div key={p.id} className="text-sm text-slate-600 py-1 flex justify-between">
                        {p.name}
                        <button onClick={() => setSequence(prev => ({...prev, [section]: prev[section].filter(x => x.id !== p.id)}))}><Icons.X /></button>
                      </div>
                    ))}
                  </div>
                ))}
              </div>
            </aside>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PresenceYoga />);
  </script>
</body>
</html>
