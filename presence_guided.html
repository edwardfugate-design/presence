<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f8f9fa">
    <title>presence • guided meditation</title>
    <script src="presence-content-manager.js"></script>
    <script src="presence-monitoring.js"></script>
    <script src="presence-auto-integrate.js"></script>
    <script src="all-libraries-compact.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --dawn-start: #f8f9fa; --dawn-mid: #e9ecef; --dawn-end: #dee2e6;
            --text-whisper: #6c757d; --text-soft: #495057; --text-present: #212529;
            --accent-focus: #6366f1;
        }
        * { -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, var(--dawn-start) 0%, var(--dawn-mid) 50%, var(--dawn-end) 100%);
            min-height: 100vh; min-height: -webkit-fill-available;
            color: var(--text-soft);
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .stat-label { font-size: 0.7rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--text-whisper); }
        .session-card {
            background: rgba(255,255,255,0.4); border: 1px solid rgba(0,0,0,0.05);
            backdrop-filter: blur(10px); transition: all 0.3s;
        }
        @media (hover: hover) {
            .session-card:hover { background: rgba(255,255,255,0.7); transform: translateY(-2px); }
        }
        .pulse-circle {
            animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
</head>
<body class="p-4 sm:p-8 md:p-16">
    <div class="max-w-4xl mx-auto">
        <header class="mb-8 sm:mb-16">
            <a href="index.html" class="stat-label mb-4 block min-h-[44px] flex items-center" style="color: var(--accent-focus);">← Hub</a>
            <h1 class="font-serif text-5xl sm:text-7xl tracking-tighter text-gray-900 mb-4">Guided Meditation</h1>
            <p class="text-base sm:text-lg text-gray-500 font-light">Voice-guided sessions for every intention</p>
        </header>

        <!-- Library View -->
        <div id="libraryView">
            <!-- Filter -->
            <div class="flex gap-2 mb-8 overflow-x-auto pb-2">
                <button onclick="filterSessions('all')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="all">All</button>
                <button onclick="filterSessions('beginner')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="beginner">Beginner</button>
                <button onclick="filterSessions('morning')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="morning">Morning</button>
                <button onclick="filterSessions('evening')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="evening">Evening</button>
                <button onclick="filterSessions('focus')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="focus">Focus</button>
                <button onclick="filterSessions('creative')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="creative">Creative</button>
                <button onclick="filterSessions('chakra')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="chakra">Chakra</button>
                <button onclick="filterSessions('mantra')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="mantra">Mantra</button>
                <button onclick="filterSessions('anxiety')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="anxiety">Anxiety</button>
                <button onclick="filterSessions('sleep')" class="filter-btn px-6 py-3 rounded-full text-xs uppercase tracking-widest transition-all min-h-[44px]" data-filter="sleep">Sleep</button>
            </div>

            <!-- Sessions Grid -->
            <div id="sessionsGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <!-- Player View -->
        <div id="playerView" class="hidden">
            <div class="text-center mb-12">
                <button onclick="exitPlayer()" class="stat-label mb-8 cursor-pointer" style="color: var(--accent-focus);">← Back to Library</button>
                
                <div class="relative w-64 h-64 mx-auto mb-8">
                    <div class="pulse-circle absolute inset-0 rounded-full" style="background: radial-gradient(circle, rgba(139, 152, 165, 0.3), rgba(139, 152, 165, 0.05));"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div id="playerStatus" class="text-6xl">●</div>
                    </div>
                </div>

                <h2 id="playerTitle" class="font-serif text-4xl mb-4 text-gray-900">Session Title</h2>
                <p id="playerDuration" class="text-sm text-gray-500 mb-8">10 minutes</p>

                <div class="space-y-4 max-w-md mx-auto mb-8">
                    <button id="playPauseBtn" onclick="togglePlayPause()" class="w-full py-4 rounded-full bg-gray-900 text-white text-sm uppercase tracking-widest hover:bg-gray-800 transition-all min-h-[48px]">
                        Begin Session
                    </button>
                    
                    <div class="flex items-center gap-4">
                        <span class="text-xs text-gray-500">Voice Speed</span>
                        <input type="range" id="speedControl" min="0.5" max="1.5" step="0.1" value="1" class="flex-1" onchange="updateSpeed()">
                        <span id="speedValue" class="text-xs text-gray-500">1.0x</span>
                    </div>

                    <div class="flex items-center gap-4">
                        <span class="text-xs text-gray-500">Volume</span>
                        <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.8" class="flex-1" onchange="updateVolume()">
                        <span id="volumeValue" class="text-xs text-gray-500">80%</span>
                    </div>
                </div>

                <div id="currentScript" class="text-sm text-gray-500 italic max-w-lg mx-auto min-h-[60px]"></div>
            </div>
        </div>
    </div>

    <script>
        // Meditation Library with full scripts
        const MEDITATION_LIBRARY = [
            {
                id: 'breath-awareness-5',
                title: 'Breath Awareness',
                duration: 5,
                category: 'beginner',
                description: 'Simple breath-focused meditation for beginners',
                script: [
                    { time: 0, text: "Welcome. Find a comfortable seated position. Close your eyes if that feels right." },
                    { time: 10, text: "Begin by taking three deep breaths. In through the nose... and out through the mouth." },
                    { time: 25, text: "Now, allow your breath to return to its natural rhythm." },
                    { time: 35, text: "Simply notice the breath as it enters... and leaves your body." },
                    { time: 50, text: "You don't need to change anything. Just observe." },
                    { time: 65, text: "When your mind wanders, and it will, gently bring your attention back to the breath." },
                    { time: 85, text: "Notice the coolness as you breathe in... the warmth as you breathe out." },
                    { time: 105, text: "Each breath is an anchor to this present moment." },
                    { time: 125, text: "Continue breathing naturally for the next few minutes." },
                    { time: 180, text: "You're doing well. Stay with the breath." },
                    { time: 240, text: "Begin to deepen your breath slightly." },
                    { time: 255, text: "Wiggle your fingers and toes." },
                    { time: 265, text: "When you're ready, gently open your eyes." },
                    { time: 280, text: "Well done. Take this calm with you into your day." }
                ]
            },
            {
                id: 'body-scan-10',
                title: 'Body Scan',
                duration: 10,
                category: 'beginner',
                description: 'Progressive relaxation through body awareness',
                script: [
                    { time: 0, text: "Welcome to this body scan meditation. Lie down or sit comfortably." },
                    { time: 10, text: "Close your eyes and take three deep breaths." },
                    { time: 25, text: "Bring your awareness to your feet. Notice any sensations." },
                    { time: 45, text: "Relax your feet. Let go of any tension." },
                    { time: 60, text: "Move your awareness to your lower legs and calves." },
                    { time: 80, text: "Soften these muscles. Release any tightness." },
                    { time: 100, text: "Shift attention to your thighs. Notice... then relax." },
                    { time: 120, text: "Bring awareness to your hips and pelvis. Let them settle." },
                    { time: 150, text: "Notice your abdomen. Let your belly soften." },
                    { time: 180, text: "Move to your chest. Feel it rise and fall with each breath." },
                    { time: 210, text: "Bring attention to your shoulders. Let them drop away from your ears." },
                    { time: 240, text: "Notice your arms, from shoulders to fingertips. Relax completely." },
                    { time: 280, text: "Soften your neck and throat." },
                    { time: 310, text: "Relax your jaw. Let your tongue rest in your mouth." },
                    { time: 340, text: "Soften your eyes, your forehead, the top of your head." },
                    { time: 370, text: "Your entire body is now relaxed and at ease." },
                    { time: 420, text: "Rest here for a few more moments." },
                    { time: 480, text: "Begin to deepen your breath." },
                    { time: 520, text: "Gently move your fingers and toes." },
                    { time: 560, text: "When you're ready, open your eyes." },
                    { time: 580, text: "Notice how relaxed you feel. Well done." }
                ]
            },
            {
                id: 'anxiety-relief-10',
                title: 'Anxiety Relief',
                duration: 10,
                category: 'anxiety',
                description: 'Calming practice for anxious moments',
                script: [
                    { time: 0, text: "You're safe right now. Find a comfortable position." },
                    { time: 10, text: "Place one hand on your heart, the other on your belly." },
                    { time: 20, text: "Take a slow breath in for four counts... 1... 2... 3... 4." },
                    { time: 30, text: "Hold gently for four... 1... 2... 3... 4." },
                    { time: 40, text: "Exhale slowly for six... 1... 2... 3... 4... 5... 6." },
                    { time: 52, text: "Again. Breathe in for four..." },
                    { time: 60, text: "Hold for four..." },
                    { time: 68, text: "Out for six..." },
                    { time: 80, text: "This breath pattern calms your nervous system." },
                    { time: 95, text: "Notice the weight of your body where it touches the surface beneath you." },
                    { time: 110, text: "You are grounded. You are here." },
                    { time: 125, text: "Name five things you can see, even with eyes closed." },
                    { time: 145, text: "Four things you can touch." },
                    { time: 160, text: "Three things you can hear." },
                    { time: 175, text: "Two things you can smell." },
                    { time: 190, text: "One thing you can taste." },
                    { time: 205, text: "This brings you into the present moment." },
                    { time: 220, text: "Anxiety lives in the future. Right now, you are safe." },
                    { time: 240, text: "Continue with your gentle breathing." },
                    { time: 300, text: "In for four... hold for four... out for six." },
                    { time: 360, text: "You're doing wonderfully." },
                    { time: 420, text: "Each breath releases a little more tension." },
                    { time: 480, text: "You are calm. You are capable. You are here." },
                    { time: 540, text: "Begin to bring movement back to your body." },
                    { time: 560, text: "Wiggle your fingers and toes." },
                    { time: 575, text: "When ready, open your eyes." },
                    { time: 590, text: "Remember: this calm is always available to you." }
                ]
            },
            {
                id: 'focus-clarity-15',
                title: 'Focus & Clarity',
                duration: 15,
                category: 'focus',
                description: 'Sharpen your mind before important work',
                script: [
                    { time: 0, text: "Welcome. This meditation will help you find clarity and focus." },
                    { time: 12, text: "Sit upright in a chair or on a cushion. Spine straight but relaxed." },
                    { time: 25, text: "Close your eyes. Take a moment to arrive here." },
                    { time: 40, text: "Set an intention. What do you want to accomplish after this practice?" },
                    { time: 60, text: "Hold that intention gently. Then let it go." },
                    { time: 75, text: "Begin to notice your breath. The natural flow of air." },
                    { time: 95, text: "With each exhale, release mental clutter." },
                    { time: 115, text: "With each inhale, invite in clarity." },
                    { time: 135, text: "Imagine your mind as a still pond. Thoughts are ripples on the surface." },
                    { time: 160, text: "You are not the ripples. You are the deep, still water beneath." },
                    { time: 185, text: "When thoughts arise, and they will, simply acknowledge them." },
                    { time: 205, text: "Like clouds passing across the sky." },
                    { time: 225, text: "You don't need to grab onto them or push them away." },
                    { time: 250, text: "Just notice... and return to the breath." },
                    { time: 270, text: "This is mental training. Each return builds focus." },
                    { time: 300, text: "Continue for the next several minutes in silence." },
                    { time: 480, text: "Notice how your mind feels now. Clearer. Sharper." },
                    { time: 540, text: "Recall your intention from the beginning." },
                    { time: 600, text: "You bring this clarity to everything you do next." },
                    { time: 720, text: "Begin to deepen your breath." },
                    { time: 780, text: "Bring gentle movement to your body." },
                    { time: 840, text: "When you're ready, open your eyes." },
                    { time: 880, text: "Carry this focused awareness with you." }
                ]
            },
            {
                id: 'gratitude-10',
                title: 'Gratitude Practice',
                duration: 10,
                category: 'beginner',
                description: 'Cultivate appreciation and positive emotion',
                script: [
                    { time: 0, text: "Welcome to this gratitude meditation." },
                    { time: 10, text: "Sit comfortably and close your eyes." },
                    { time: 20, text: "Take three deep, nourishing breaths." },
                    { time: 40, text: "Bring to mind something you're grateful for today." },
                    { time: 60, text: "It can be something small. The warmth of sunlight. A kind word." },
                    { time: 80, text: "Hold this in your awareness. Notice how it makes you feel." },
                    { time: 105, text: "Where do you feel gratitude in your body?" },
                    { time: 125, text: "Perhaps warmth in your chest. A softening." },
                    { time: 145, text: "Breathe into this feeling. Let it expand." },
                    { time: 170, text: "Now think of a person you appreciate." },
                    { time: 190, text: "See their face. Remember their kindness." },
                    { time: 215, text: "Silently say: Thank you." },
                    { time: 235, text: "Feel appreciation flow from your heart." },
                    { time: 260, text: "Now expand your gratitude. Your home. Your health. This moment." },
                    { time: 290, text: "Each breath is a gift. Notice this miracle." },
                    { time: 320, text: "Even challenges have taught you something." },
                    { time: 350, text: "Gratitude doesn't deny difficulty. It finds light alongside it." },
                    { time: 380, text: "Rest in this feeling of appreciation." },
                    { time: 450, text: "You can return to gratitude anytime." },
                    { time: 510, text: "Begin to bring awareness back to your body." },
                    { time: 540, text: "Wiggle your fingers. Stretch gently." },
                    { time: 565, text: "Open your eyes when ready." },
                    { time: 590, text: "Take this gratitude into your day." }
                ]
            },
            {
                id: 'sleep-preparation-20',
                title: 'Sleep Preparation',
                duration: 20,
                category: 'sleep',
                description: 'Wind down for restful sleep',
                script: [
                    { time: 0, text: "Welcome. It's time to prepare for sleep." },
                    { time: 12, text: "Lie down in bed. Get comfortable." },
                    { time: 25, text: "You have nowhere to be. Nothing to do." },
                    { time: 40, text: "This is time just for rest." },
                    { time: 55, text: "Close your eyes. Take a deep breath in..." },
                    { time: 65, text: "...and sigh it out. Release the day." },
                    { time: 80, text: "Again. Breathe in..." },
                    { time: 88, text: "...sigh out. Let everything go." },
                    { time: 105, text: "One more time. In..." },
                    { time: 112, text: "...and release." },
                    { time: 130, text: "Now allow your breath to find its natural rhythm." },
                    { time: 150, text: "With each exhale, your body becomes heavier." },
                    { time: 175, text: "Sinking into the bed beneath you." },
                    { time: 200, text: "Notice your feet. They can completely relax now." },
                    { time: 230, text: "Let them become heavy. Almost melting into the mattress." },
                    { time: 260, text: "Your legs... heavy and still." },
                    { time: 290, text: "Hips and pelvis... releasing all tension." },
                    { time: 320, text: "Your belly softens with each breath." },
                    { time: 350, text: "Chest rises and falls... gentle waves." },
                    { time: 380, text: "Shoulders drop away from your ears." },
                    { time: 410, text: "Arms become heavy. Fingers soft." },
                    { time: 440, text: "Your neck relaxes. Throat soft." },
                    { time: 470, text: "Jaw releases. Teeth don't need to touch." },
                    { time: 500, text: "Soften your eyes. Your forehead." },
                    { time: 530, text: "The top of your head." },
                    { time: 560, text: "Your entire body is now deeply relaxed." },
                    { time: 600, text: "If thoughts come, that's okay." },
                    { time: 630, text: "You don't need to follow them." },
                    { time: 660, text: "Just notice... and return to the breath." },
                    { time: 690, text: "You are safe. You are held." },
                    { time: 720, text: "Sleep will come when it's ready." },
                    { time: 780, text: "For now, just rest here." },
                    { time: 840, text: "Breathing... relaxing... letting go." },
                    { time: 960, text: "Good night. Sleep well." }
                ]
            },
            {
                id: 'morning-energy-10',
                title: 'Morning Energy',
                duration: 10,
                category: 'morning',
                description: 'Awaken body and mind for a vibrant day',
                script: [
                    { time: 0, text: "Good morning. Welcome to a new day." },
                    { time: 10, text: "Sit comfortably with your spine tall." },
                    { time: 20, text: "Take a deep breath in through your nose, filling your lungs completely." },
                    { time: 32, text: "Exhale fully through your mouth with a sighing sound." },
                    { time: 42, text: "Again. Big breath in..." },
                    { time: 48, text: "...and release with sound. Ahhh." },
                    { time: 58, text: "One more. Breathe in energy..." },
                    { time: 65, text: "...breathe out sleepiness." },
                    { time: 75, text: "Notice how you feel right now. Groggy? Tired? That's okay." },
                    { time: 95, text: "We're going to gently wake up your system." },
                    { time: 110, text: "Bring your awareness to your body. Start with your toes." },
                    { time: 125, text: "Wiggle them. Flex and point your feet." },
                    { time: 140, text: "Roll your ankles. Wake up your lower body." },
                    { time: 155, text: "Shift your hips side to side. Gentle movement." },
                    { time: 170, text: "Roll your shoulders back. Big circles." },
                    { time: 185, text: "Turn your head left... then right. Slow and mindful." },
                    { time: 205, text: "Now, set an intention for today." },
                    { time: 220, text: "What quality do you want to embody? Patience? Joy? Focus?" },
                    { time: 240, text: "Choose one word. Hold it in your mind." },
                    { time: 260, text: "Take a deep breath. This is your anchor word for today." },
                    { time: 280, text: "Visualize your day ahead. See yourself moving through it with ease." },
                    { time: 310, text: "Challenges may arise. You meet them with your intention." },
                    { time: 340, text: "Take another energizing breath. Feel vitality entering your body." },
                    { time: 365, text: "Your cells are waking up. Your mind is becoming clear." },
                    { time: 390, text: "You have everything you need for this day." },
                    { time: 420, text: "Breathe in possibility..." },
                    { time: 430, text: "...breathe out doubt." },
                    { time: 450, text: "Breathe in energy..." },
                    { time: 460, text: "...breathe out resistance." },
                    { time: 480, text: "One final deep breath." },
                    { time: 510, text: "Stretch your arms overhead. Reach for the sky." },
                    { time: 530, text: "When you're ready, open your eyes." },
                    { time: 550, text: "Welcome this beautiful day. You're ready." }
                ]
            },
            {
                id: 'evening-release-12',
                title: 'Evening Release',
                duration: 12,
                category: 'evening',
                description: 'Let go of the day and transition to rest',
                script: [
                    { time: 0, text: "Welcome. The day is ending. It's time to let it go." },
                    { time: 15, text: "Find a comfortable seated position or lie down." },
                    { time: 28, text: "Close your eyes. Take a moment to arrive here." },
                    { time: 42, text: "Notice the transition. The day is behind you now." },
                    { time: 60, text: "Take a deep breath in..." },
                    { time: 68, text: "...and exhale. Release the day with that breath." },
                    { time: 80, text: "Again. Breathe in..." },
                    { time: 88, text: "...breathe out. Let it all go." },
                    { time: 100, text: "Think back over your day. No judgment, just observation." },
                    { time: 120, text: "What went well? Acknowledge it." },
                    { time: 140, text: "What was difficult? See it without holding onto it." },
                    { time: 165, text: "You don't need to carry today into tomorrow." },
                    { time: 185, text: "Imagine each event of the day as a leaf on a stream." },
                    { time: 210, text: "Watch them float by. One by one, they drift away." },
                    { time: 235, text: "Conversations... gone downstream." },
                    { time: 255, text: "Tasks completed or undone... floating away." },
                    { time: 275, text: "Emotions you felt... acknowledged and released." },
                    { time: 300, text: "Your mind is clearing. Like the sky after a storm." },
                    { time: 325, text: "Bring awareness to your body. Scan for tension." },
                    { time: 345, text: "Your jaw. Is it clenched? Let it soften." },
                    { time: 365, text: "Your shoulders. Drop them down, away from your ears." },
                    { time: 385, text: "Your belly. Let it be soft." },
                    { time: 405, text: "Each exhale releases a little more tension." },
                    { time: 430, text: "You did enough today. You are enough." },
                    { time: 455, text: "Tomorrow is a new page. For now, rest." },
                    { time: 480, text: "Breathe in peace..." },
                    { time: 492, text: "...breathe out the day." },
                    { time: 510, text: "Continue breathing gently for a few more moments." },
                    { time: 600, text: "You can stay here as long as you like." },
                    { time: 660, text: "When you're ready, slowly open your eyes." },
                    { time: 700, text: "Good evening. Rest well." }
                ]
            },
            {
                id: 'creative-flow-15',
                title: 'Creative Inspiration',
                duration: 15,
                category: 'creative',
                description: 'Open the channels of creativity and imagination',
                script: [
                    { time: 0, text: "Welcome to this creative meditation." },
                    { time: 12, text: "Sit comfortably. Let your body relax but your mind stay alert." },
                    { time: 28, text: "Close your eyes. Take a deep breath." },
                    { time: 40, text: "Creativity lives in the space between thoughts." },
                    { time: 58, text: "We're going to create that space now." },
                    { time: 75, text: "Begin with your breath. Natural rhythm." },
                    { time: 92, text: "As you breathe, imagine your mind as a vast, open sky." },
                    { time: 115, text: "Thoughts are clouds. They come... they go." },
                    { time: 135, text: "You are the sky. Spacious. Open. Limitless." },
                    { time: 160, text: "Now, bring to mind a creative challenge or project." },
                    { time: 185, text: "Don't force a solution. Just hold the question lightly." },
                    { time: 210, text: "Like holding water in your cupped hands." },
                    { time: 235, text: "Release any pressure to perform or produce." },
                    { time: 260, text: "True creativity emerges when we stop trying." },
                    { time: 285, text: "Imagine a door in your mind. It's been closed." },
                    { time: 310, text: "As you breathe, the door begins to open." },
                    { time: 335, text: "Warm light spills through. This is your creative source." },
                    { time: 365, text: "You don't create from your head. You channel." },
                    { time: 390, text: "You are a vessel. Inspiration flows through you." },
                    { time: 420, text: "Trust the images that come. Don't judge them." },
                    { time: 450, text: "The strangest ideas are often the most interesting." },
                    { time: 480, text: "Continue to rest in this open, receptive state." },
                    { time: 540, text: "Notice what arises. Colors. Shapes. Words. Feelings." },
                    { time: 600, text: "Your only job is to notice." },
                    { time: 660, text: "The muse speaks in whispers. Listen closely." },
                    { time: 720, text: "When you're ready, begin to come back." },
                    { time: 780, text: "Bring that creative openness with you." },
                    { time: 840, text: "Slowly open your eyes." },
                    { time: 880, text: "Create from this place. Trust what wants to emerge." }
                ]
            },
            {
                id: 'chakra-balance-20',
                title: 'Chakra Balance',
                duration: 20,
                category: 'chakra',
                description: 'Journey through the seven energy centers',
                script: [
                    { time: 0, text: "Welcome. We'll journey through your seven chakras, or energy centers." },
                    { time: 18, text: "Sit with your spine straight. Close your eyes." },
                    { time: 32, text: "Take three deep breaths to center yourself." },
                    { time: 55, text: "Bring awareness to the base of your spine. Your root chakra." },
                    { time: 75, text: "Visualize a glowing red sphere. Grounding. Stable. Safe." },
                    { time: 100, text: "Breathe into this space. Feel your connection to the earth." },
                    { time: 130, text: "Silently affirm: I am grounded. I am safe." },
                    { time: 155, text: "Move awareness to your lower abdomen. Your sacral chakra." },
                    { time: 175, text: "See an orange sphere. Creativity. Pleasure. Flow." },
                    { time: 200, text: "Breathe here. Feel your creative life force." },
                    { time: 230, text: "Affirm: I embrace my creativity. I flow with life." },
                    { time: 260, text: "Rise to your solar plexus. Your power center." },
                    { time: 280, text: "Visualize yellow light. Confidence. Will. Purpose." },
                    { time: 305, text: "Breathe into your core. Feel your inner strength." },
                    { time: 335, text: "Affirm: I am powerful. I trust myself." },
                    { time: 365, text: "Move to your heart center. Middle of your chest." },
                    { time: 385, text: "See green light. Love. Compassion. Connection." },
                    { time: 410, text: "Breathe into your heart. Let it expand." },
                    { time: 440, text: "Affirm: I give and receive love freely." },
                    { time: 470, text: "Shift to your throat. Your voice." },
                    { time: 490, text: "Blue light glows here. Truth. Expression. Communication." },
                    { time: 515, text: "Breathe here. Honor your authentic voice." },
                    { time: 545, text: "Affirm: I speak my truth. I am heard." },
                    { time: 575, text: "Rise to your third eye. Between your eyebrows." },
                    { time: 595, text: "Indigo light. Intuition. Insight. Vision." },
                    { time: 620, text: "Breathe here. Trust your inner knowing." },
                    { time: 650, text: "Affirm: I see clearly. I trust my intuition." },
                    { time: 680, text: "Finally, the crown of your head. Your connection to source." },
                    { time: 705, text: "Violet or white light. Unity. Consciousness. Divinity." },
                    { time: 735, text: "Breathe here. Feel yourself connected to all that is." },
                    { time: 770, text: "Affirm: I am one with everything." },
                    { time: 800, text: "Now see all seven chakras glowing in perfect harmony." },
                    { time: 830, text: "A rainbow of light running through your entire being." },
                    { time: 870, text: "You are balanced. You are whole." },
                    { time: 960, text: "Take a deep breath. Bring awareness back to your body." },
                    { time: 1080, text: "Wiggle your fingers and toes." },
                    { time: 1140, text: "When ready, gently open your eyes." },
                    { time: 1180, text: "Carry this balance with you." }
                ]
            },
            {
                id: 'om-mantra-10',
                title: 'Om Mantra Practice',
                duration: 10,
                category: 'mantra',
                description: 'Vibrational healing through sacred sound',
                script: [
                    { time: 0, text: "Welcome to Om mantra meditation. The primordial sound." },
                    { time: 18, text: "Sit comfortably with a tall spine. Hands can rest on your knees." },
                    { time: 35, text: "Close your eyes. Take a few natural breaths." },
                    { time: 52, text: "Om is said to be the sound of the universe itself." },
                    { time: 72, text: "It has three parts. A... U... M. Then silence." },
                    { time: 95, text: "Take a deep breath in." },
                    { time: 105, text: "As you exhale, chant: Ooooommmmm." },
                    { time: 120, text: "Feel the vibration in your chest. In your throat. In your head." },
                    { time: 145, text: "Breathe in again. And chant: Ooooommmmm." },
                    { time: 165, text: "You can chant aloud or silently in your mind." },
                    { time: 185, text: "Let's continue together. Breathe in..." },
                    { time: 195, text: "Ooooommmmm." },
                    { time: 210, text: "Breathe in..." },
                    { time: 218, text: "Ooooommmmm." },
                    { time: 235, text: "Notice the sound resonating through your body." },
                    { time: 255, text: "This vibration is healing. Calming. Centering." },
                    { time: 280, text: "Continue at your own pace. Breathe... chant... rest... repeat." },
                    { time: 360, text: "Let the mantra wash over you like gentle waves." },
                    { time: 420, text: "You are not creating the sound. You are the sound." },
                    { time: 480, text: "Continue chanting softly." },
                    { time: 540, text: "Let's do three final rounds together." },
                    { time: 555, text: "Breathe in... Ooooommmmm." },
                    { time: 575, text: "Breathe in... Ooooommmmm." },
                    { time: 595, text: "Last one. Breathe in... Ooooommmmm." },
                    { time: 615, text: "Now rest in silence. Feel the vibration still resonating." },
                    { time: 660, text: "This sound connects you to everything." },
                    { time: 720, text: "When you're ready, take a final deep breath." },
                    { time: 780, text: "Slowly open your eyes." },
                    { time: 800, text: "Namaste. The divine in me honors the divine in you." }
                ]
            },
            {
                id: 'loving-kindness-12',
                title: 'Loving-Kindness (Metta)',
                duration: 12,
                category: 'mantra',
                description: 'Cultivate compassion for self and others',
                script: [
                    { time: 0, text: "Welcome to loving-kindness meditation." },
                    { time: 12, text: "Sit comfortably and close your eyes." },
                    { time: 25, text: "Begin by directing kindness toward yourself." },
                    { time: 42, text: "Place a hand on your heart if that feels right." },
                    { time: 58, text: "Silently repeat these phrases:" },
                    { time: 72, text: "May I be happy." },
                    { time: 85, text: "May I be healthy." },
                    { time: 98, text: "May I be safe." },
                    { time: 110, text: "May I live with ease." },
                    { time: 125, text: "Again. May I be happy." },
                    { time: 138, text: "May I be healthy." },
                    { time: 150, text: "May I be safe." },
                    { time: 162, text: "May I live with ease." },
                    { time: 180, text: "Feel these wishes for yourself. You deserve kindness." },
                    { time: 205, text: "Now bring to mind someone you love. See their face." },
                    { time: 228, text: "Direct these same wishes to them." },
                    { time: 245, text: "May you be happy." },
                    { time: 258, text: "May you be healthy." },
                    { time: 270, text: "May you be safe." },
                    { time: 282, text: "May you live with ease." },
                    { time: 300, text: "Feel the warmth of wishing them well." },
                    { time: 322, text: "Now think of a neutral person. Someone you see but don't know well." },
                    { time: 348, text: "A cashier. A neighbor. Someone passing by." },
                    { time: 368, text: "May you be happy." },
                    { time: 380, text: "May you be healthy." },
                    { time: 392, text: "May you be safe." },
                    { time: 404, text: "May you live with ease." },
                    { time: 425, text: "Even strangers deserve our kindness." },
                    { time: 448, text: "If you feel ready, think of someone difficult." },
                    { time: 468, text: "This is advanced. It's okay if you're not ready." },
                    { time: 490, text: "May you be happy. May you be healthy." },
                    { time: 510, text: "May you be safe. May you live with ease." },
                    { time: 535, text: "Wishing them well doesn't mean approving of harmful actions." },
                    { time: 562, text: "It means releasing yourself from the burden of holding hostility." },
                    { time: 592, text: "Finally, expand your kindness to all beings everywhere." },
                    { time: 618, text: "May all beings be happy." },
                    { time: 632, text: "May all beings be healthy." },
                    { time: 645, text: "May all beings be safe." },
                    { time: 658, text: "May all beings live with ease." },
                    { time: 680, text: "Feel your heart expanding. Connecting you to all life." },
                    { time: 720, text: "Rest here in this feeling of universal kindness." },
                    { time: 780, text: "When you're ready, take a deep breath." },
                    { time: 840, text: "Slowly open your eyes." },
                    { time: 860, text: "Carry this loving-kindness into your day." }
                ]
            }
        ];

        let currentSession = null;
        let currentScriptIndex = 0;
        let sessionStartTime = null;
        let isPlaying = false;
        let synth = window.speechSynthesis;
        let currentUtterance = null;
        let currentFilter = 'all';

        function renderLibrary() {
            const grid = document.getElementById('sessionsGrid');
            const sessions = currentFilter === 'all' 
                ? MEDITATION_LIBRARY 
                : MEDITATION_LIBRARY.filter(s => s.category === currentFilter);

            grid.innerHTML = sessions.map(session => `
                <div class="session-card p-6 rounded-2xl cursor-pointer" onclick="selectSession('${session.id}')">
                    <div class="stat-label mb-2">${session.category}</div>
                    <h3 class="text-2xl font-serif mb-2 text-gray-900">${session.title}</h3>
                    <p class="text-sm text-gray-600 mb-4">${session.description}</p>
                    <div class="text-xs text-gray-500">${session.duration} minutes</div>
                </div>
            `).join('');

            // Update filter button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const filter = btn.dataset.filter;
                if (filter === currentFilter) {
                    btn.style.background = 'var(--accent-focus)';
                    btn.style.color = 'white';
                } else {
                    btn.style.background = 'rgba(255,255,255,0.4)';
                    btn.style.color = 'var(--text-soft)';
                }
            });
        }

        function filterSessions(category) {
            currentFilter = category;
            renderLibrary();
        }

        function selectSession(id) {
            currentSession = MEDITATION_LIBRARY.find(s => s.id === id);
            document.getElementById('libraryView').classList.add('hidden');
            document.getElementById('playerView').classList.remove('hidden');
            
            document.getElementById('playerTitle').textContent = currentSession.title;
            document.getElementById('playerDuration').textContent = `${currentSession.duration} minutes`;
            
            resetPlayer();
        }

        function exitPlayer() {
            stopSession();
            document.getElementById('libraryView').classList.remove('hidden');
            document.getElementById('playerView').classList.add('hidden');
        }

        function resetPlayer() {
            currentScriptIndex = 0;
            sessionStartTime = null;
            isPlaying = false;
            document.getElementById('playPauseBtn').textContent = 'Begin Session';
            document.getElementById('currentScript').textContent = '';
            document.getElementById('playerStatus').textContent = '●';
        }

        function togglePlayPause() {
            if (isPlaying) {
                pauseSession();
            } else {
                startSession();
            }
        }

        function startSession() {
            isPlaying = true;
            sessionStartTime = Date.now();
            currentScriptIndex = 0;
            
            document.getElementById('playPauseBtn').textContent = 'Pause';
            document.getElementById('playerStatus').textContent = '▶';
            
            playNextSegment();
            
            // Track practice time
            localStorage.setItem('lastPracticeStart', Date.now());
        }

        function pauseSession() {
            isPlaying = false;
            if (currentUtterance) {
                synth.cancel();
            }
            document.getElementById('playPauseBtn').textContent = 'Resume';
            document.getElementById('playerStatus').textContent = '❚❚';
        }

        function stopSession() {
            isPlaying = false;
            if (currentUtterance) {
                synth.cancel();
            }
            
            // Save practice time
            const startTime = localStorage.getItem('lastPracticeStart');
            if (startTime) {
                const duration = Math.floor((Date.now() - startTime) / 1000 / 60);
                const totalMins = parseInt(localStorage.getItem('totalPracticeMinutes') || '0');
                localStorage.setItem('totalPracticeMinutes', totalMins + duration);
            }
        }

        function playNextSegment() {
            if (!isPlaying || !currentSession) return;
            
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const script = currentSession.script;
            
            // Find next segment to play
            while (currentScriptIndex < script.length && script[currentScriptIndex].time <= elapsed) {
                const segment = script[currentScriptIndex];
                speakText(segment.text);
                currentScriptIndex++;
            }
            
            // Check if session complete
            if (currentScriptIndex >= script.length && elapsed > script[script.length - 1].time + 10) {
                completeSession();
                return;
            }
            
            // Continue checking
            setTimeout(playNextSegment, 1000);
        }

        function speakText(text) {
            if (synth.speaking) {
                synth.cancel();
            }
            
            currentUtterance = new SpeechSynthesisUtterance(text);
            currentUtterance.rate = parseFloat(document.getElementById('speedControl').value);
            currentUtterance.volume = parseFloat(document.getElementById('volumeControl').value);
            currentUtterance.pitch = 0.9;
            
            // Display text
            document.getElementById('currentScript').textContent = text;
            
            synth.speak(currentUtterance);
            
            // Haptic feedback
            if ('vibrate' in navigator) {
                navigator.vibrate(10);
            }
        }

        function completeSession() {
            isPlaying = false;
            document.getElementById('playPauseBtn').textContent = 'Session Complete';
            document.getElementById('playerStatus').textContent = '✓';
            document.getElementById('currentScript').textContent = 'Well done. Return to the library for another session.';
            
            stopSession();
        }

        function updateSpeed() {
            const speed = document.getElementById('speedControl').value;
            document.getElementById('speedValue').textContent = `${speed}x`;
        }

        function updateVolume() {
            const volume = Math.round(document.getElementById('volumeControl').value * 100);
            document.getElementById('volumeValue').textContent = `${volume}%`;
        }

        // Initialize
        renderLibrary();
    </script>
</body>
</html>
