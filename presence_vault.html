<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>presence • alignment lab</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&family=Newsreader:ital,wght@0,300;0,400;1,400&display=swap" rel="stylesheet">
    
    <script src="yoga-v3.js"></script>

    <style>
        :root {
            --dawn-start: #f8f9fa;
            --text-present: #212529;
            --accent-focus: #6366f1;
            --accent-success: #84cc16;
            --accent-alert: #ef4444;
        }

        body { 
            font-family: 'JetBrains Mono', monospace; 
            background: linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%);
            color: var(--text-present);
            min-height: 100vh;
        }
        
        .font-serif { font-family: 'Newsreader', serif; }

        .bio-card { 
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bio-card:hover { transform: translateY(-2px); border-color: var(--accent-focus); background: rgba(255, 255, 255, 0.7); }

        /* Joint Sliders */
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 2px; background: rgba(0,0,0,0.1); outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: var(--text-present); border-radius: 50%; cursor: pointer; }

        .pose-skeleton { stroke: rgba(0,0,0,0.15); stroke-width: 2.5; fill: none; stroke-linecap: round; }
        .skeleton-joint { fill: var(--accent-focus); stroke: white; stroke-width: 2; }
        
        .modal-overlay { background: rgba(233, 236, 239, 0.9); backdrop-filter: blur(15px); z-index: 100; position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; overflow-y: auto; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const MUSCLE_MAP = {
            quadriceps: { name: 'Quads', color: '#84cc16' },
            hamstrings: { name: 'Hamstrings', color: '#6366f1' },
            core: { name: 'Core', color: '#ef4444' },
            glutes: { name: 'Glutes', color: '#f59e0b' },
            shoulders: { name: 'Deltoids', color: '#8b98a5' }
        };

        function AlignmentLab() {
            const [search, setSearch] = useState('');
            const [filter, setFilter] = useState('All');
            const [selectedPose, setSelectedPose] = useState(null);
            const [angles, setAngles] = useState({});
            const [masterData, setMasterData] = useState([]);

            // Data Sync
            useEffect(() => {
                const sync = setInterval(() => {
                    if (window.ALL_POSES) {
                        setMasterData(window.ALL_POSES);
                        clearInterval(sync);
                    }
                }, 100);
                return () => clearInterval(sync);
            }, []);

            // Angle Initialization
            useEffect(() => {
                if (selectedPose?.checkpoints) {
                    const init = {};
                    selectedPose.checkpoints.forEach(cp => init[cp.joint] = cp.ideal);
                    setAngles(init);
                }
            }, [selectedPose]);

            const filteredData = useMemo(() => {
                return masterData.filter(p => {
                    const matchText = p.name?.toLowerCase().includes(search.toLowerCase()) || p.sanskrit?.toLowerCase().includes(search.toLowerCase());
                    const matchCat = filter === 'All' || p.family === filter;
                    return matchText && matchCat;
                });
            }, [search, filter, masterData]);

            const getStatus = (joint, val) => {
                const cp = selectedPose.checkpoints.find(c => c.joint === joint);
                if (!cp) return { label: 'Optimal', color: '#84cc16' };
                if (val >= cp.range[0] && val <= cp.range[1]) return { label: 'Optimal', color: '#84cc16' };
                return Math.abs(val - cp.ideal) <= 15 ? { label: 'Acceptable', color: '#6366f1' } : { label: 'Misaligned', color: '#ef4444' };
            };

            return (
                <div className="p-6 sm:p-12 max-w-7xl mx-auto min-h-screen">
                    {/* Integrated Header */}
                    <header className="mb-16">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-8 mb-10">
                            <div>
                                <h1 className="text-5xl font-serif tracking-tight text-slate-900">presence • alignment</h1>
                                <p className="text-[10px] uppercase tracking-[0.4em] mt-3 text-indigo-500 font-bold">Biomechanical Laboratory / v5.1</p>
                            </div>
                            <input 
                                type="text" 
                                placeholder="Search Library..." 
                                className="bg-transparent border-b border-slate-300 py-2 outline-none focus:border-indigo-500 w-full md:w-72 text-sm italic"
                                onChange={(e) => setSearch(e.target.value)}
                            />
                        </div>
                        <div className="flex gap-8 border-b border-slate-200 overflow-x-auto pb-2 no-scrollbar">
                            {['All', 'Standing', 'Backbend', 'Forward Fold', 'Twist', 'Inversion'].map(cat => (
                                <button 
                                    key={cat} 
                                    onClick={() => setFilter(cat)}
                                    className={`text-[10px] uppercase tracking-widest pb-2 transition-all ${filter === cat ? 'text-indigo-600 border-b-2 border-indigo-600 font-bold' : 'text-slate-400'}`}
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>
                    </header>

                    {/* Integrated Grid */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        {filteredData.map(pose => (
                            <div key={pose.id} onClick={() => setSelectedPose(pose)} className="bio-card p-6 rounded-3xl cursor-pointer group">
                                <div className="flex justify-between items-start mb-4">
                                    <span className="text-[9px] font-black bg-slate-100 px-2 py-1 rounded text-slate-500 uppercase">{pose.family}</span>
                                    <span className="text-[9px] font-mono text-slate-300">#{pose.id}</span>
                                </div>
                                <h3 className="text-xl font-serif text-slate-800 group-hover:text-indigo-600 transition-colors">{pose.name}</h3>
                                <p className="text-xs italic text-slate-400 font-serif mb-6">{pose.sanskrit}</p>
                                <div className="flex gap-1">
                                    {[...Array(5)].map((_, i) => (
                                        <div key={i} className={`w-1 h-1 rounded-full ${i < (pose.intensity || 1) ? 'bg-indigo-400' : 'bg-slate-100'}`}></div>
                                    ))}
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Full Feature Modal */}
                    {selectedPose && (
                        <div className="modal-overlay p-4 sm:p-8" onClick={() => setSelectedPose(null)}>
                            <div className="bg-white rounded-[3rem] w-full max-w-6xl p-8 sm:p-12 shadow-2xl relative max-h-[95vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setSelectedPose(null)} className="absolute top-8 right-10 text-3xl text-slate-300 hover:text-slate-900 transition-colors">✕</button>
                                
                                <div className="grid lg:grid-cols-2 gap-16">
                                    {/* Column 1: Biometric Visualization */}
                                    <div>
                                        <div className="mb-8">
                                            <span className="text-indigo-500 text-[10px] font-bold uppercase tracking-[0.3em]">Unit Analysis</span>
                                            <h2 className="text-5xl font-serif mt-2 text-slate-900">{selectedPose.name}</h2>
                                            <p className="text-xl text-slate-400 font-serif italic mt-1">{selectedPose.sanskrit}</p>
                                        </div>
                                        
                                        <div className="bg-slate-50 rounded-[2.5rem] p-8 aspect-square relative border border-slate-100">
                                            <svg viewBox="0 0 400 500" className="w-full h-full">
                                                <g className="pose-skeleton">
                                                    <circle cx="200" cy="80" r="28" /> {/* Head */}
                                                    <line x1="200" y1="108" x2="200" y2="280" /> {/* Spine */}
                                                    <line x1="200" y1="140" x2="130" y2="220" /> {/* Arms */}
                                                    <line x1="200" y1="140" x2="270" y2="220" />
                                                    <line x1="200" y1="280" x2="150" y2="430" /> {/* Legs */}
                                                    <line x1="200" y1="280" x2="250" y2="430" />
                                                </g>
                                                <circle cx="200" cy="140" r="6" className="skeleton-joint" />
                                                <circle cx="200" cy="280" r="6" className="skeleton-joint" />
                                                <circle cx="150" cy="430" r="6" className="skeleton-joint" />
                                                <circle cx="250" cy="430" r="6" className="skeleton-joint" />
                                            </svg>

                                            <div className="absolute bottom-8 left-8 flex flex-wrap gap-2 max-w-[70%]">
                                                {selectedPose.muscles?.map(m => (
                                                    <div key={m} className="flex items-center gap-2 bg-white px-3 py-1.5 rounded-full shadow-sm border border-slate-50">
                                                        <div className="w-2 h-2 rounded-full" style={{background: MUSCLE_MAP[m]?.color || '#6366f1'}}></div>
                                                        <span className="text-[10px] font-bold uppercase text-slate-600">{MUSCLE_MAP[m]?.name || m}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Column 2: Biomechanical Controls */}
                                    <div className="flex flex-col justify-center py-4">
                                        <div className="space-y-10">
                                            <section>
                                                <h4 className="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-8 flex items-center gap-3">
                                                    <span className="w-8 h-[1px] bg-slate-200"></span> Joint Checkpoints
                                                </h4>
                                                <div className="space-y-8">
                                                    {(selectedPose.checkpoints || []).map(cp => {
                                                        const current = angles[cp.joint] || cp.ideal;
                                                        const status = getStatus(cp.joint, current);
                                                        
                                                        return (
                                                            <div key={cp.joint}>
                                                                <div className="flex justify-between mb-3 items-end">
                                                                    <span className="text-xs font-medium text-slate-700">{cp.label}</span>
                                                                    <span className="text-xl font-mono" style={{color: status.color}}>{current}°</span>
                                                                </div>
                                                                <input 
                                                                    type="range" min="0" max="180" value={current} 
                                                                    onChange={(e) => setAngles({...angles, [cp.joint]: parseInt(e.target.value)})}
                                                                />
                                                                <div className="flex justify-between text-[9px] uppercase tracking-widest mt-2">
                                                                    <span className="text-slate-400">Target: {cp.ideal}°</span>
                                                                    <span style={{color: status.color, fontWeight: 'bold'}}>{status.label}</span>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </section>

                                            <section className="bg-slate-50 p-8 rounded-[2rem] border border-slate-100">
                                                <h4 className="text-[10px] font-bold uppercase tracking-widest text-indigo-500 mb-4">Tactile Cues</h4>
                                                <p className="text-sm font-serif italic leading-relaxed text-slate-600">
                                                    {selectedPose.instructions || "Focus on the grounding of the four corners of the feet. Lengthen through the crown of the head while maintaining a neutral pelvic floor."}
                                                </p>
                                            </section>

                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="p-5 bg-white border border-slate-100 rounded-2xl">
                                                    <span className="text-[9px] uppercase text-slate-400 block mb-1 tracking-widest">Primary Focus</span>
                                                    <span className="text-xs font-bold text-slate-800">{selectedPose.benefits?.[0] || "Structural Integrity"}</span>
                                                </div>
                                                <div className="p-5 bg-white border border-slate-100 rounded-2xl">
                                                    <span className="text-[9px] uppercase text-slate-400 block mb-1 tracking-widest">Hold Time</span>
                                                    <span className="text-xs font-bold text-slate-800">{selectedPose.duration || 45}s Recovery</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AlignmentLab />);
    </script>
</body>
</html>
