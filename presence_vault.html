<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Vault ‚Ä¢ Presence</title>
    <script src="presence-monitoring.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="pose-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { background: #fdfcfb; font-family: sans-serif; color: #1a1a1a; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e0e7ff; border-radius: 10px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        
        .filter-chip {
            transition: all 0.2s ease;
            cursor: pointer;
            user-select: none;
        }
        .filter-chip.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        .filter-chip:hover:not(.active) {
            background: #eef2ff;
            border-color: #c7d2fe;
        }
        
        .pose-card {
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.4s ease forwards;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pose-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
        }
        
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 1rem;
            height: 80px;
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .stats-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #e0e7ff;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .category-tab {
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            background: white;
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .category-tab:hover {
            border-color: #c7d2fe;
            background: #faf5ff;
        }
        
        .category-tab.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
    </style>
</head>
<body class="p-4 md:p-8 lg:p-16">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-12">
            <a href="index.html" class="text-[10px] uppercase tracking-[0.4em] text-indigo-400 font-bold mb-4 inline-block hover:text-indigo-600 transition-colors">‚Üê Hub</a>
            <div class="flex flex-col md:flex-row md:justify-between md:items-end gap-6">
                <div>
                    <h1 class="font-serif text-5xl md:text-7xl tracking-tighter mb-2">The Vault</h1>
                    <p class="text-gray-500 text-sm">Your complete yoga pose library</p>
                </div>
                <div class="flex flex-wrap gap-3 items-center">
                    <div class="stats-badge">
                        <span class="text-2xl">üìö</span>
                        <span id="totalCount">500+</span> poses
                    </div>
                    <div class="stats-badge">
                        <span class="text-2xl">üîç</span>
                        <span id="filteredCount">0</span> filtered
                    </div>
                </div>
            </div>
        </header>

        <!-- Search & Filters -->
        <div class="mb-8 space-y-4">
            <!-- Search Bar -->
            <input 
                type="text" 
                id="searchInput" 
                placeholder="Search by pose name or Sanskrit..." 
                class="w-full bg-white border border-indigo-100 p-4 md:p-6 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-200 shadow-sm text-base md:text-lg font-serif transition-all"
                oninput="handleSearch()"
            >
            
            <!-- Category Tabs -->
            <div class="flex flex-wrap gap-2" id="categoryTabs">
                <button class="category-tab active" onclick="filterByCategory('all')">All Poses</button>
                <button class="category-tab" onclick="filterByCategory('standing')">Standing</button>
                <button class="category-tab" onclick="filterByCategory('seated')">Seated</button>
                <button class="category-tab" onclick="filterByCategory('backbends')">Backbends</button>
                <button class="category-tab" onclick="filterByCategory('inversions')">Inversions</button>
                <button class="category-tab" onclick="filterByCategory('twists')">Twists</button>
                <button class="category-tab" onclick="filterByCategory('restorative')">Restorative</button>
                <button class="category-tab" onclick="filterByCategory('core')">Core</button>
                <button class="category-tab" onclick="filterByCategory('hipOpeners')">Hip Openers</button>
                <button class="category-tab" onclick="filterByCategory('balance')">Balance</button>
            </div>
            
            <!-- Level Filters -->
            <div class="flex flex-wrap gap-2">
                <span class="text-xs uppercase tracking-wider text-gray-400 self-center mr-2">Level:</span>
                <button class="filter-chip px-4 py-2 rounded-full border border-gray-200 text-sm active" onclick="toggleLevel('all')">All</button>
                <button class="filter-chip px-4 py-2 rounded-full border border-gray-200 text-sm" onclick="toggleLevel('Beginner')">Beginner</button>
                <button class="filter-chip px-4 py-2 rounded-full border border-gray-200 text-sm" onclick="toggleLevel('Intermediate')">Intermediate</button>
                <button class="filter-chip px-4 py-2 rounded-full border border-gray-200 text-sm" onclick="toggleLevel('Advanced')">Advanced</button>
            </div>
        </div>

        <!-- Results Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="poseGrid">
            <!-- Poses will be inserted here -->
        </div>
        
        <!-- Load More Button -->
        <div class="text-center mt-8">
            <button 
                id="loadMoreBtn" 
                class="px-8 py-4 rounded-full bg-indigo-500 text-white text-sm font-bold uppercase tracking-widest hover:bg-indigo-600 transition-all shadow-lg shadow-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed"
                onclick="loadMore()"
            >
                Load More Poses
            </button>
        </div>
        
        <!-- Loading Skeleton -->
        <div id="loadingSkeleton" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden">
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
            <div class="loading-skeleton"></div>
        </div>

        <!-- Selection Summary (Sticky at bottom on mobile) -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-indigo-100 p-4 shadow-2xl md:static md:mt-12 md:rounded-2xl md:border md:shadow-none transition-all" id="selectionPanel">
            <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-4 flex-1">
                    <span class="text-sm font-medium text-gray-600">
                        <span id="selectedCount">0</span> poses selected
                    </span>
                    <button onclick="clearSelection()" class="text-xs text-indigo-500 hover:text-indigo-700 uppercase tracking-wider font-bold">Clear</button>
                </div>
                <div class="flex gap-3 w-full md:w-auto">
                    <button onclick="syncToStudio()" class="flex-1 md:flex-none px-6 py-3 rounded-full bg-indigo-500 text-white text-xs font-bold uppercase tracking-widest hover:bg-indigo-600 transition-all shadow-lg shadow-indigo-100">
                        Sync to Studio
                    </button>
                    <button onclick="exportSelection()" class="flex-1 md:flex-none px-6 py-3 rounded-full border-2 border-indigo-500 text-indigo-500 text-xs font-bold uppercase tracking-widest hover:bg-indigo-50 transition-all">
                        Export JSON
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== STATE MANAGEMENT =====
        let currentCategory = 'all';
        let currentLevel = 'all';
        let searchQuery = '';
        let selectedPoses = new Set();
        let displayedPoses = [];
        let currentPage = 0;
        const POSES_PER_PAGE = 30; // Load 30 at a time for performance

        // ===== FILTERING LOGIC =====
        function getFilteredPoses() {
            let filtered = ALL_POSES;
            
            // Filter by category
            if (currentCategory !== 'all') {
                filtered = filtered.filter(p => p.category === currentCategory);
            }
            
            // Filter by level
            if (currentLevel !== 'all') {
                filtered = filtered.filter(p => p.level === currentLevel);
            }
            
            // Filter by search
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(query) || 
                    p.sanskrit.toLowerCase().includes(query) ||
                    p.muscles.some(m => m.toLowerCase().includes(query)) ||
                    p.benefits.some(b => b.toLowerCase().includes(query))
                );
            }
            
            return filtered;
        }

        // ===== RENDERING =====
        function renderPoses(poses, append = false) {
            const grid = document.getElementById('poseGrid');
            
            if (!append) {
                grid.innerHTML = '';
            }
            
            poses.forEach((pose, index) => {
                const card = createPoseCard(pose, index);
                grid.appendChild(card);
            });
        }

        function createPoseCard(pose, index) {
            const card = document.createElement('div');
            card.className = 'pose-card p-5 bg-white rounded-2xl border border-indigo-50 cursor-pointer';
            card.style.animationDelay = `${(index % POSES_PER_PAGE) * 0.03}s`;
            card.onclick = () => togglePoseSelection(pose.id);
            
            const isSelected = selectedPoses.has(pose.id);
            if (isSelected) {
                card.classList.add('ring-2', 'ring-indigo-500', 'border-indigo-500');
            }
            
            const levelColors = {
                'Beginner': 'bg-green-100 text-green-700',
                'Intermediate': 'bg-yellow-100 text-yellow-700',
                'Advanced': 'bg-red-100 text-red-700'
            };
            
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <div class="flex-1">
                        <h3 class="font-serif text-xl font-medium mb-1">${pose.name}</h3>
                        <p class="text-xs text-gray-400 italic">${pose.sanskrit}</p>
                    </div>
                    <div class="w-6 h-6 rounded-full border-2 border-indigo-200 flex items-center justify-center transition-all ${isSelected ? 'bg-indigo-500 border-indigo-500' : ''}">
                        ${isSelected ? '<svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>' : ''}
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-1.5 mb-3">
                    <span class="px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider ${levelColors[pose.level]}">${pose.level}</span>
                    <span class="px-2 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider bg-indigo-50 text-indigo-600">${pose.category}</span>
                </div>
                
                <div class="space-y-2 text-xs text-gray-600">
                    <div>
                        <span class="font-semibold">Muscles:</span> ${pose.muscles.slice(0, 3).join(', ')}${pose.muscles.length > 3 ? '...' : ''}
                    </div>
                    <div>
                        <span class="font-semibold">Benefits:</span> ${pose.benefits.slice(0, 2).join(', ')}
                    </div>
                    <div class="text-gray-400">
                        ‚è± ${pose.duration}s
                    </div>
                </div>
            `;
            
            return card;
        }

        // ===== LAZY LOADING =====
        function loadMore() {
            const filtered = getFilteredPoses();
            const start = displayedPoses.length;
            const end = Math.min(start + POSES_PER_PAGE, filtered.length);
            const newPoses = filtered.slice(start, end);
            
            if (newPoses.length > 0) {
                showLoadingSkeleton();
                
                // Simulate network delay for smooth UX
                setTimeout(() => {
                    hideLoadingSkeleton();
                    renderPoses(newPoses, true);
                    displayedPoses = filtered.slice(0, end);
                    updateLoadMoreButton(end, filtered.length);
                }, 200);
            }
        }

        function updateLoadMoreButton(displayed, total) {
            const btn = document.getElementById('loadMoreBtn');
            if (displayed >= total) {
                btn.disabled = true;
                btn.textContent = 'All Poses Loaded';
            } else {
                btn.disabled = false;
                btn.textContent = `Load More (${total - displayed} remaining)`;
            }
        }

        function showLoadingSkeleton() {
            document.getElementById('loadingSkeleton').classList.remove('hidden');
        }

        function hideLoadingSkeleton() {
            document.getElementById('loadingSkeleton').classList.add('hidden');
        }

        // ===== SEARCH & FILTER HANDLERS =====
        function handleSearch() {
            searchQuery = document.getElementById('searchInput').value;
            resetAndRender();
        }

        function filterByCategory(category) {
            currentCategory = category;
            
            // Update active tab
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            resetAndRender();
        }

        function toggleLevel(level) {
            currentLevel = level;
            
            // Update active chip
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');
            
            resetAndRender();
        }

        function resetAndRender() {
            displayedPoses = [];
            currentPage = 0;
            document.getElementById('poseGrid').innerHTML = '';
            
            const filtered = getFilteredPoses();
            const initial = filtered.slice(0, POSES_PER_PAGE);
            
            renderPoses(initial);
            displayedPoses = initial;
            updateLoadMoreButton(initial.length, filtered.length);
            updateStats();
        }

        // ===== SELECTION MANAGEMENT =====
        function togglePoseSelection(poseId) {
            if (selectedPoses.has(poseId)) {
                selectedPoses.delete(poseId);
            } else {
                selectedPoses.add(poseId);
            }
            updateSelectionUI();
        }

        function clearSelection() {
            selectedPoses.clear();
            updateSelectionUI();
        }

        function updateSelectionUI() {
            // Update selected count
            document.getElementById('selectedCount').textContent = selectedPoses.size;
            
            // Re-render current poses to update checkmarks
            const filtered = getFilteredPoses();
            const current = filtered.slice(0, displayedPoses.length);
            renderPoses(current);
        }

        // ===== STATS =====
        function updateStats() {
            const filtered = getFilteredPoses();
            document.getElementById('totalCount').textContent = ALL_POSES.length;
            document.getElementById('filteredCount').textContent = filtered.length;
        }

        // ===== EXPORT & SYNC =====
        function syncToStudio() {
            if (selectedPoses.size === 0) {
                alert('Please select at least one pose to sync.');
                return;
            }
            
            const selected = ALL_POSES.filter(p => selectedPoses.has(p.id));
            const syncData = {};
            
            selected.forEach(pose => {
                if (!syncData[pose.category]) {
                    syncData[pose.category] = [];
                }
                syncData[pose.category].push({
                    name: pose.name,
                    sanskrit: pose.sanskrit,
                    level: pose.level,
                    duration: pose.duration,
                    muscles: pose.muscles,
                    benefits: pose.benefits
                });
            });
            
            localStorage.setItem('presence_vault_sync', JSON.stringify(syncData));
            
            // Show success feedback
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì Synced to Studio!';
            btn.classList.add('bg-green-500');
            btn.classList.remove('bg-indigo-500');
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('bg-green-500');
                btn.classList.add('bg-indigo-500');
            }, 2000);
        }

        function exportSelection() {
            if (selectedPoses.size === 0) {
                alert('Please select at least one pose to export.');
                return;
            }
            
            const selected = ALL_POSES.filter(p => selectedPoses.has(p.id));
            const json = JSON.stringify(selected, null, 2);
            
            // Download as JSON file
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `presence-poses-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ===== INTERSECTION OBSERVER FOR AUTO-LOAD =====
        function setupInfiniteScroll() {
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting && !document.getElementById('loadMoreBtn').disabled) {
                    loadMore();
                }
            }, { threshold: 0.1 });
            
            observer.observe(document.getElementById('loadMoreBtn'));
        }

        // ===== INITIALIZATION =====
        window.onload = function() {
            resetAndRender();
            setupInfiniteScroll();
            
            // Show welcome message
            console.log(`üßò The Vault loaded with ${ALL_POSES.length} poses!`);
        };
    </script>
</body>
</html>
