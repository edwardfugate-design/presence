<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Presence ¬∑ Ambient</title>
    <link rel="preconnect" href="https://cdn.freesound.org">
    <style>
        body { background: #fdfcfb; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; touch-action: manipulation; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .aura-field { filter: blur(120px); transition: all 6s ease-in-out; position: fixed; inset: -10%; width: 120%; height: 120%; z-index: -1; opacity: 0.5; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .loading-screen { position: fixed; inset: 0; background: #fdfcfb; display: flex; align-items: center; justify-content: center; z-index: 9999; opacity: 1; transition: opacity 0.3s ease-out; }
        .loading-screen.hidden { opacity: 0; pointer-events: none; }
        .min-h-screen { min-height: 100vh; }
        .p-6 { padding: 1.5rem; }
        .max-w-5xl { max-width: 64rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .pb-40 { padding-bottom: 10rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-8 { gap: 2rem; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .justify-between { justify-content: space-between; }
        .mb-12 { margin-bottom: 3rem; }
        .mb-16 { margin-bottom: 4rem; }
        .text-6xl { font-size: 3.75rem; line-height: 1; }
        .italic { font-style: italic; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .rounded-full { border-radius: 9999px; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .transition-all { transition: all 0.3s ease; }
        .fixed { position: fixed; }
        .bottom-10 { bottom: 2.5rem; }
        
        @media (min-width: 640px) { .sm:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); } .md:p-12 { padding: 3rem; } .md:flex-row { flex-direction: row; } }
        @media (min-width: 1024px) { .lg:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div style="text-align: center;">
            <div style="width: 40px; height: 40px; border: 3px solid #e5e7eb; border-top-color: #6366f1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            <p style="margin-top: 1rem; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.5;">Presence</p>
        </div>
    </div>
    
    <div id="root"></div>

    <script>
        const MASTER_LIBRARY = {
            "üåßÔ∏è Weather": [
                { id: 'light-rain', n: 'Light Rain', urls: ['https://cdn.freesound.org/previews/344/344430_5121236-lq.mp3'] },
                { id: 'heavy-rain', n: 'Heavy Rain', urls: ['https://cdn.freesound.org/previews/243/243627_5121236-lq.mp3'] },
                { id: 'thunder', n: 'Thunder Storm', urls: ['https://cdn.freesound.org/previews/162/162476_2394245-lq.mp3'] },
                { id: 'wind-gentle', n: 'Gentle Wind', urls: ['https://cdn.freesound.org/previews/234/234226_1648170-lq.mp3'] }
            ],
            "üåä Water": [
                { id: 'ocean-calm', n: 'Ocean Calm', urls: ['https://cdn.freesound.org/previews/180/180493_3283808-lq.mp3'] },
                { id: 'river', n: 'River Flow', urls: ['https://cdn.freesound.org/previews/255/255537_4486188-lq.mp3'] },
                { id: 'waterfall', n: 'Waterfall', urls: ['https://cdn.freesound.org/previews/257/257181_4486188-lq.mp3'] }
            ],
            "üå≤ Earth": [
                { id: 'forest', n: 'Forest', urls: ['https://cdn.freesound.org/previews/416/416062_5121236-lq.mp3'] },
                { id: 'jungle', n: 'Jungle Night', urls: ['https://cdn.freesound.org/previews/447/447912_5674468-lq.mp3'] }
            ],
            "üê¶ Life": [
                { id: 'birds', n: 'Morning Birds', urls: ['https://cdn.freesound.org/previews/447/447912_5674468-lq.mp3'] },
                { id: 'crickets', n: 'Crickets', urls: ['https://cdn.freesound.org/previews/412/412068_6975646-lq.mp3'] }
            ],
            "üî• Fire": [
                { id: 'campfire', n: 'Campfire', urls: ['https://cdn.freesound.org/previews/320/320321_527080-lq.mp3'] }
            ],
            "üßò Purity": [
                { id: 'white-noise', n: 'White Noise', urls: ['https://cdn.freesound.org/previews/360/360602_5121236-lq.mp3'] },
                { id: 'brown-noise', n: 'Brown Noise', urls: ['https://cdn.freesound.org/previews/360/360601_5121236-lq.mp3'] },
                { id: 'vagus', n: 'Vagus Nerve', urls: ['https://cdn.freesound.org/previews/680/680145_1648170-lq.mp3'] }
            ],
            "üèôÔ∏è Urban": [
                { id: 'city', n: 'City Hum', urls: ['https://cdn.freesound.org/previews/268/268903_4548252-lq.mp3'] },
                { id: 'subway', n: 'Subway Rumble', urls: ['https://cdn.freesound.org/previews/207/207924_624691-lq.mp3'] }
            ],
            "‚òï Indoor": [
                { id: 'cafe', n: 'Caf√© Murmur', urls: ['https://cdn.freesound.org/previews/547/547662_9879924-lq.mp3'] },
                { id: 'library', n: 'Library', urls: ['https://cdn.freesound.org/previews/350/350359_6264898-lq.mp3'] }
            ],
            "üè† Domestic": [
                { id: 'fan', n: 'Ceiling Fan', urls: ['https://cdn.freesound.org/previews/320/320398_527080-lq.mp3'] },
                { id: 'clock', n: 'Clock Tick', urls: ['https://cdn.freesound.org/previews/350/350359_6264898-lq.mp3'] }
            ],
            "üåô Night": [
                { id: 'midnight', n: 'Midnight Rain', urls: ['https://cdn.freesound.org/previews/416/416710_5121236-lq.mp3'] }
            ]
        };

        const AudioEngine = {
            ctx: null, masterGain: null, filterNode: null, 
            activeSources: [], bufferCache: new Map(), timerId: null,

            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    this.filterNode = this.ctx.createBiquadFilter();
                    this.masterGain = this.ctx.createGain();
                    this.filterNode.connect(this.masterGain);
                    this.masterGain.connect(this.ctx.destination);
                    this.filterNode.type = 'lowpass';
                    this.filterNode.frequency.value = 20000;
                    this.masterGain.gain.value = 0;
                }
                if (this.ctx.state === 'suspended') this.ctx.resume();
            },

            async play(soundId, onLoading) {
                this.init();
                this.stop();
                onLoading(true);
                const sound = Object.values(MASTER_LIBRARY).flat().find(s => s.id === soundId);
                if (!sound) return;

                try {
                    for (const url of sound.urls) {
                        let buffer;
                        if (this.bufferCache.has(url)) { buffer = this.bufferCache.get(url); } 
                        else {
                            const resp = await fetch(url);
                            const arrayBuffer = await resp.arrayBuffer();
                            buffer = await this.ctx.decodeAudioData(arrayBuffer);
                            this.bufferCache.set(url, buffer);
                        }
                        
                        const source = this.ctx.createBufferSource();
                        source.buffer = buffer;
                        source.loop = true;
                        
                        // STOCHASTIC PLAYBACK (Removes loop feel)
                        source.start(0, Math.random() * buffer.duration);
                        source.playbackRate.value = 0.98 + (Math.random() * 0.04);
                        source.detune.value = (Math.random() * 10) - 5;

                        source.connect(this.filterNode);
                        this.activeSources.push(source);
                    }
                    this.masterGain.gain.linearRampToValueAtTime(0.5, this.ctx.currentTime + 2);
                    onLoading(false);
                } catch (e) { onLoading(false); }
            },

            updateSignal(mode) {
                if (!this.filterNode) return;
                const now = this.ctx.currentTime;
                if (mode === 'Focus') {
                    this.filterNode.type = 'highpass';
                    this.filterNode.frequency.exponentialRampToValueAtTime(400, now + 2);
                } else if (mode === 'Rest') {
                    this.filterNode.type = 'lowpass';
                    this.filterNode.frequency.exponentialRampToValueAtTime(600, now + 2);
                } else {
                    this.filterNode.type = 'lowpass';
                    this.filterNode.frequency.exponentialRampToValueAtTime(20000, now + 2);
                }
            },

            setTimer(mins, onEnd) {
                if (this.timerId) clearTimeout(this.timerId);
                this.timerId = setTimeout(() => {
                    this.fadeStop();
                    onEnd();
                }, mins * 60000);
            },

            fadeStop() {
                if (this.masterGain) {
                    this.masterGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 5);
                    setTimeout(() => this.stop(), 5100);
                }
            },

            stop() {
                if (this.timerId) clearTimeout(this.timerId);
                if (this.masterGain) this.masterGain.gain.value = 0;
                this.activeSources.forEach(s => { try { s.stop(); } catch(e){} });
                this.activeSources = [];
            }
        };

        let state = { category: "üåßÔ∏è Weather", playing: null, loading: false, signal: 'Neutral', timer: null };

        function render() {
            const root = document.getElementById('root');
            const auraColor = state.signal === 'Focus' ? '#fef3c7' : state.signal === 'Rest' ? '#dbeafe' : '#e0e7ff';
            
            root.innerHTML = `
                <div class="min-h-screen p-6 md:p-12 max-w-5xl mx-auto pb-40">
                    <div class="aura-field" style="background: ${auraColor};"></div>
                    
                    <header class="flex flex-col md:flex-row justify-between items-start mb-16 gap-8">
                        <div>
                            <h1 class="text-6xl font-serif italic" style="font-weight: 200;">presence</h1>
                            <p style="font-size: 0.625rem; text-transform: uppercase; letter-spacing: 0.4em; opacity: 0.3; margin-top: 1rem;">Ambient Soundscapes</p>
                        </div>

                        <div class="flex flex-col gap-4 items-end">
                            <div class="flex" style="background: rgba(0,0,0,0.05); padding: 0.25rem; border-radius: 9999px; backdrop-filter: blur(20px);">
                                ${['Neutral', 'Focus', 'Rest'].map(m => `
                                    <button onclick="setSignal('${m}')" class="px-6 py-2 rounded-full transition-all" style="font-size: 0.625rem; text-transform: uppercase; ${state.signal === m ? 'background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); font-weight: 700;' : 'opacity: 0.3;'}">${m}</button>
                                `).join('')}
                            </div>
                            
                            ${state.playing ? `
                                <div class="flex gap-2">
                                    ${[15, 30, 60].map(m => `
                                        <button onclick="setTimer(${m})" style="font-size: 0.563rem; text-transform: uppercase; padding: 0.25rem 0.75rem; border-radius: 0.375rem; border: 1px solid; transition: all 0.15s; ${state.timer === m ? 'background: black; color: white;' : 'opacity: 0.4; border-color: rgba(0,0,0,0.1);'}">${m}m Timer</button>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </header>

                    <nav class="flex gap-8 mb-12 overflow-x-auto hide-scrollbar" style="border-bottom: 1px solid rgba(0,0,0,0.05);">
                        ${Object.keys(MASTER_LIBRARY).map(c => `
                            <button onclick="setCategory('${c}')" style="padding-bottom: 1.25rem; font-size: 0.688rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.2em; white-space: nowrap; ${state.category === c ? 'border-bottom: 2px solid black; opacity: 1;' : 'opacity: 0.2;'}">${c}</button>
                        `).join('')}
                    </nav>

                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                        ${MASTER_LIBRARY[state.category].map(s => `
                            <button onclick="toggleSound('${s.id}')" style="padding: 1.5rem; border-radius: 2rem; text-align: left; transition: all 0.4s; height: 8rem; display: flex; flex-direction: column; justify-content: space-between; ${state.playing === s.id ? 'background: white; box-shadow: 0 20px 40px rgba(0,0,0,0.1); transform: scale(1.02);' : 'background: rgba(255,255,255,0.4);'}">
                                <div style="width: 0.5rem; height: 0.5rem; border-radius: 9999px; ${state.playing === s.id ? 'background: #6366f1; animation: pulse 2s infinite;' : 'background: rgba(0,0,0,0.1);'}"></div>
                                <div>
                                    <h3 style="font-size: 0.875rem; font-weight: 600;">${s.n}</h3>
                                    <p style="font-size: 0.563rem; opacity: 0.3; text-transform: uppercase;">Seamless Presence</p>
                                </div>
                            </button>
                        `).join('')}
                    </div>

                    ${(state.playing || state.loading) ? `
                        <div class="fixed bottom-10" style="left: 50%; transform: translateX(-50%); width: 90%; max-width: 28rem; background: rgba(255,255,255,0.95); backdrop-filter: blur(40px); padding: 1.5rem; border-radius: 2.5rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 2.5rem; height: 2.5rem; border-radius: 9999px; background: #eef2ff; display: flex; align-items: center; justify-content: center;">
                                    <div style="width: 0.5rem; height: 0.5rem; background: #6366f1; border-radius: 9999px; animation: ping 1s infinite;"></div>
                                </div>
                                <div>
                                    <p style="font-size: 0.563rem; text-transform: uppercase; opacity: 0.4;">${state.loading ? 'Syncing Layers...' : 'Non-Looping Field'}</p>
                                    <p style="font-weight: 500; font-size: 0.875rem;">${state.timer ? `${state.timer}m remaining` : 'Infinite Session'}</p>
                                </div>
                            </div>
                            <button onclick="stopAll()" style="background: black; color: white; padding: 0.75rem 2rem; border-radius: 9999px; font-size: 0.625rem; font-weight: 700; text-transform: uppercase;">Stop</button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function setCategory(cat) { state.category = cat; render(); }
        function setSignal(sig) { state.signal = sig; AudioEngine.updateSignal(sig); render(); }
        function setTimer(mins) { state.timer = mins; AudioEngine.setTimer(mins, () => { state.timer = null; state.playing = null; render(); }); render(); }
        function toggleSound(id) {
            if (state.playing === id) { stopAll(); } 
            else { state.playing = id; AudioEngine.play(id, (l) => { state.loading = l; render(); }); }
            render();
        }
        function stopAll() { AudioEngine.stop(); state.playing = null; state.timer = null; render(); }

        const style = document.createElement('style');
        style.textContent = `@keyframes spin { to { transform: rotate(360deg); } } @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } } @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }`;
        document.head.appendChild(style);

        window.addEventListener('DOMContentLoaded', () => {
            render();
            setTimeout(() => document.getElementById('loadingScreen').classList.add('hidden'), 300);
        });
    </script>
</body>
</html>
