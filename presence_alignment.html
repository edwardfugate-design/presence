<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>presents ‚Ä¢ alignment lab</title>
    
    <script src="presence-content-manager.js"></script>
    <script src="presence-monitoring.js"></script>
    <script src="presence-auto-integrate.js"></script>
    <script src="all-libraries-compact.js"></script>
    <script src="pose-database.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Instrument+Serif:italic&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --indigo-focus: #6366f1;
            --zen-bg: #fafafa;
        }
        body { font-family: 'Inter', sans-serif; background: var(--zen-bg); color: #1e293b; margin: 0; }
        .font-serif { font-family: 'Instrument Serif', serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        .bio-card { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.05); transition: all 0.3s ease; }
        .pose-skeleton { stroke: #cbd5e1; stroke-width: 2; fill: none; }
        .skeleton-joint { fill: var(--indigo-focus); }
        
        input[type="range"] { -webkit-appearance: none; height: 2px; background: #e2e8f0; border-radius: 5px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: #1e293b; border-radius: 50%; cursor: pointer; }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse-soft { animation: pulse 3s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // Shared Anatomy Data
        const MUSCLE_GROUPS = {
            quadriceps: { name: 'Quadriceps', color: '#84cc16' },
            hamstrings: { name: 'Hamstrings', color: '#6366f1' },
            glutes: { name: 'Gluteus Maximus', color: '#f59e0b' },
            core: { name: 'Core', color: '#ef4444' },
            shoulders: { name: 'Deltoids', color: '#8b98a5' },
            back: { name: 'Erector Spinae', color: '#6366f1' }
        };

        function AlignmentLab() {
            const [view, setView] = useState('analysis'); // analysis, anatomy, biometrics
            const [search, setSearch] = useState('');
            const [selectedPose, setSelectedPose] = useState(null);
            const [masterData, setMasterData] = useState([]);
            const [angles, setAngles] = useState({});

            // RECONNECTING THE 500+ POSES
            useEffect(() => {
                const loadData = () => {
                    // Try getting data from any of your global libraries
                    const data = window.ALL_POSES || window.POSE_LIBRARY || [];
                    if (data.length > 0) {
                        setMasterData(data);
                        // Default to first pose
                        if (!selectedPose) setSelectedPose(data[0]);
                    }
                };
                loadData();
                const timer = setInterval(loadData, 500);
                return () => clearInterval(timer);
            }, []);

            const filteredPoses = useMemo(() => {
                return masterData.filter(p => p.name.toLowerCase().includes(search.toLowerCase())).slice(0, 50); 
            }, [search, masterData]);

            if (masterData.length === 0) return <div className="h-screen flex items-center justify-center font-serif italic text-xl">Initializing 500+ Pose Library...</div>;

            return (
                <div className="min-h-screen pb-20">
                    {/* Header: Presents Branding */}
                    <header className="p-8 md:p-12 border-b border-slate-100 bg-white/50 backdrop-blur-md sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
                            <div className="flex items-center gap-6">
                                <a href="index.html" className="text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-indigo-600">‚Üê Main</a>
                                <h1 className="text-5xl font-serif italic text-indigo-950">presents<span className="text-indigo-500">‚Ä¢</span>lab</h1>
                            </div>
                            <input 
                                type="text" 
                                placeholder="Search 500+ Poses..." 
                                className="w-full md:w-80 p-4 rounded-2xl border border-slate-100 bg-white font-serif italic outline-none focus:ring-2 focus:ring-indigo-500/10"
                                onChange={(e) => setSearch(e.target.value)}
                            />
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-6 md:p-8">
                        {/* Tab Switcher */}
                        <div className="flex gap-2 mb-10 overflow-x-auto no-scrollbar">
                            {['analysis', 'anatomy', 'biometrics'].map(v => (
                                <button key={v} onClick={() => setView(v)}
                                    className={`px-8 py-3 rounded-full text-[10px] font-black uppercase tracking-[0.2em] transition-all ${view === v ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white text-slate-400 border border-slate-100'}`}>
                                    {v}
                                </button>
                            ))}
                        </div>

                        {/* Pose Quick-Select (Horizontal) */}
                        <div className="flex gap-4 overflow-x-auto pb-6 no-scrollbar mb-10">
                            {filteredPoses.map(pose => (
                                <button key={pose.id} onClick={() => setSelectedPose(pose)}
                                    className={`flex-shrink-0 px-6 py-4 rounded-[1.5rem] bio-card text-left min-w-[180px] ${selectedPose?.id === pose.id ? 'border-indigo-500 ring-1 ring-indigo-500' : ''}`}>
                                    <div className="text-[8px] font-bold text-slate-300 uppercase mb-1">{pose.category || pose.family}</div>
                                    <div className="text-sm font-semibold text-slate-700">{pose.name}</div>
                                </button>
                            ))}
                        </div>

                        {/* Analysis Grid */}
                        <div className="grid lg:grid-cols-2 gap-8">
                            
                            {/* Visual Side */}
                            <div className="space-y-8">
                                <div className="bio-card p-10 rounded-[3rem] aspect-square flex items-center justify-center relative overflow-hidden">
                                    <div className="absolute top-8 left-10 text-[10px] font-black uppercase tracking-widest text-slate-300">Biomechanical Skeleton</div>
                                    {view === 'analysis' && <SkeletonDiagram pose={selectedPose} angles={angles} />}
                                    {view === 'anatomy' && <AnatomySVG pose={selectedPose} />}
                                    {view === 'biometrics' && <BiometricCanvas pose={selectedPose} angles={angles} />}
                                </div>
                                
                                {/* Breath & Instructions */}
                                <div className="bg-indigo-600 text-white p-10 rounded-[3rem] shadow-xl relative overflow-hidden">
                                    <span className="text-[9px] font-black uppercase tracking-widest opacity-50 block mb-4">Instructor Protocol</span>
                                    <p className="text-2xl font-serif italic mb-6 leading-relaxed">"{selectedPose?.instructions}"</p>
                                    <div className="inline-flex items-center gap-3 bg-white/10 px-4 py-2 rounded-full border border-white/10 animate-pulse-soft">
                                        <div className="w-2 h-2 rounded-full bg-white"></div>
                                        <span className="text-[10px] font-bold uppercase tracking-widest">{selectedPose?.breath || "Natural Breath"}</span>
                                    </div>
                                </div>
                            </div>

                            {/* Control Side */}
                            <div className="space-y-6">
                                <div className="bio-card p-10 rounded-[3rem]">
                                    <h3 className="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-10 border-b pb-4">Alignment Metrics</h3>
                                    <div className="space-y-10">
                                        {selectedPose?.checkpoints?.map(cp => (
                                            <div key={cp.joint}>
                                                <div className="flex justify-between items-end mb-4">
                                                    <div>
                                                        <div className="text-[9px] font-black text-slate-300 uppercase mb-1">{cp.label}</div>
                                                        <div className="text-2xl font-serif italic text-slate-800">{angles[cp.joint] || cp.ideal}¬∞</div>
                                                    </div>
                                                    <div className="text-[10px] font-mono text-indigo-400">Target: {cp.ideal}¬∞</div>
                                                </div>
                                                <input 
                                                    type="range" min="0" max="180" 
                                                    value={angles[cp.joint] || cp.ideal}
                                                    onChange={(e) => setAngles({...angles, [cp.joint]: parseInt(e.target.value)})}
                                                    className="w-full"
                                                />
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="bio-card p-10 rounded-[3rem]">
                                    <h3 className="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-6">Target Muscles</h3>
                                    <div className="flex flex-wrap gap-2">
                                        {selectedPose?.muscles?.map(m => (
                                            <span key={m} className="px-4 py-2 bg-slate-100 rounded-xl text-[10px] font-bold uppercase tracking-widest text-slate-500">
                                                {m}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        // --- SUB-COMPONENTS ---

        function SkeletonDiagram({ pose, angles }) {
            return (
                <svg viewBox="0 0 400 500" className="w-full h-full max-w-sm">
                    <circle cx="200" cy="80" r="30" className="pose-skeleton" />
                    <line x1="200" y1="110" x2="200" y2="280" className="pose-skeleton" />
                    <circle cx="200" cy="110" r="6" className="skeleton-joint" />
                    <circle cx="200" cy="280" r="6" className="skeleton-joint" />
                    <path d="M 140 180 Q 200 130 260 180" className="pose-skeleton" style={{stroke: '#6366f1', strokeWidth: 4}} />
                    <text x="200" y="450" textAnchor="middle" className="font-serif italic text-2xl fill-slate-300 capitalize">{pose?.name}</text>
                </svg>
            );
        }

        function AnatomySVG({ pose }) {
            return (
                <div className="text-center">
                    <div className="text-6xl mb-4">üßò</div>
                    <div className="stat-label">Anatomical Map Active</div>
                    <div className="mt-4 flex flex-col gap-2">
                        {pose?.muscles?.map(m => (
                            <div key={m} className="text-[10px] font-mono py-1 px-3 border border-indigo-100 rounded text-indigo-500 bg-indigo-50/50">
                                V-ACTIVATE: {m.toUpperCase()}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function BiometricCanvas({ pose, angles }) {
            return (
                <div className="grid grid-cols-2 gap-8">
                    {pose?.checkpoints?.map(cp => (
                        <div key={cp.joint} className="text-center">
                            <div className="w-24 h-24 rounded-full border-4 border-slate-100 flex items-center justify-center relative">
                                <div className="absolute inset-0 border-4 border-indigo-500 rounded-full" style={{clipPath: `inset(${100 - (angles[cp.joint] || cp.ideal)/1.8}% 0 0 0)`}}></div>
                                <span className="text-xl font-mono">{angles[cp.joint] || cp.ideal}¬∞</span>
                            </div>
                            <div className="text-[8px] font-black uppercase mt-3 text-slate-400">{cp.joint}</div>
                        </div>
                    ))}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AlignmentLab />);
    </script>
</body>
</html>
