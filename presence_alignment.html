<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>presents ‚Ä¢ master lab</title>
    
    <script src="presence-content-manager.js"></script>
    <script src="all-libraries-compact.js"></script>
    <script src="pose-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Instrument+Serif:italic&family=Inter:wght@400;600;900&display=swap" rel="stylesheet">

    <style>
        :root { --accent: #6366f1; --bg: #f8f9fa; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #1e293b; }
        .font-serif { font-family: 'Instrument Serif', serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Glassmorphism */
        .glass-panel { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,0.05); }
        
        /* Interactive Elements */
        input[type="range"] { -webkit-appearance: none; height: 4px; background: #e2e8f0; border-radius: 10px; }
        input[type="range"]::-webkit-slider-thumb { 
            -webkit-appearance: none; width: 18px; height: 18px; 
            background: #1e293b; border-radius: 50%; cursor: pointer; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-active { background: #1e293b !important; color: white !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        @keyframes pulse-ring { 0% { transform: scale(.8); opacity: 0.5; } 100% { transform: scale(1.2); opacity: 0; } }
        .breath-ring { position: relative; }
        .breath-ring::after { 
            content: ''; position: absolute; inset: -4px; border: 2px solid var(--accent); 
            border-radius: inherit; animation: pulse-ring 3s ease-out infinite; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        function MasterLab() {
            const [allPoses, setAllPoses] = useState([]);
            const [selectedId, setSelectedId] = useState(null);
            const [view, setView] = useState('biometrics'); 
            const [search, setSearch] = useState('');
            const [filters, setFilters] = useState({ level: 'All', category: 'All' });
            const [userAngles, setUserAngles] = useState({});

            // 1. DATA RECOVERY: Sync 500+ poses
            useEffect(() => {
                const interval = setInterval(() => {
                    const data = window.ALL_POSES || window.POSE_LIBRARY || [];
                    if (data.length > 0) {
                        setAllPoses(data);
                        if (!selectedId) setSelectedId(data[0].id);
                        clearInterval(interval);
                    }
                }, 200);
                return () => clearInterval(interval);
            }, []);

            // 2. SEARCH & FILTER LOGIC
            const filtered = useMemo(() => {
                return allPoses.filter(p => {
                    const matchesSearch = p.name.toLowerCase().includes(search.toLowerCase()) || (p.sanskrit && p.sanskrit.toLowerCase().includes(search.toLowerCase()));
                    const matchesLevel = filters.level === 'All' || p.level === filters.level;
                    const matchesCat = filters.category === 'All' || p.category === filters.category;
                    return matchesSearch && matchesLevel && matchesCat;
                }).slice(0, 100); // Performance cap for 500+ items
            }, [search, filters, allPoses]);

            const currentPose = useMemo(() => allPoses.find(p => p.id === selectedId), [selectedId, allPoses]);

            if (!currentPose) return <div className="h-screen flex items-center justify-center font-serif italic text-2xl">Initializing Lab...</div>;

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="p-6 md:p-10 border-b border-slate-200 glass-panel sticky top-0 z-50">
                        <div className="max-w-[1600px] mx-auto flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                            <div>
                                <h1 className="text-4xl font-serif italic text-slate-950">presents<span className="text-indigo-500">‚Ä¢</span>alignment lab</h1>
                                <div className="flex gap-4 mt-2">
                                    <select className="bg-transparent text-[10px] font-black uppercase tracking-widest text-slate-400 outline-none" 
                                            onChange={e => setFilters({...filters, category: e.target.value})}>
                                        <option>All Categories</option>
                                        <option>Standing</option>
                                        <option>Backbend</option>
                                        <option>Inversion</option>
                                    </select>
                                    <select className="bg-transparent text-[10px] font-black uppercase tracking-widest text-slate-400 outline-none"
                                            onChange={e => setFilters({...filters, level: e.target.value})}>
                                        <option>All Levels</option>
                                        <option>Beginner</option>
                                        <option>Intermediate</option>
                                        <option>Advanced</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div className="flex gap-4 w-full lg:w-auto">
                                <input 
                                    type="text" 
                                    placeholder="Search library..." 
                                    className="px-6 py-3 rounded-full border border-slate-200 w-full lg:w-64 font-serif italic"
                                    onChange={e => setSearch(e.target.value)}
                                />
                                <a href="index.html" className="px-6 py-3 rounded-full bg-slate-950 text-white text-[10px] font-black uppercase tracking-widest">Exit</a>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-[1600px] mx-auto p-6 md:p-10 flex flex-col lg:flex-row gap-10">
                        
                        {/* LEFT: POSE INDEX (500+ Scroller) */}
                        <aside className="w-full lg:w-80 h-[200px] lg:h-[70vh] overflow-y-auto no-scrollbar space-y-2 pr-2">
                            <div className="text-[10px] font-black text-slate-300 uppercase tracking-widest mb-4 sticky top-0 bg-[#f8f9fa] py-2">Library Index</div>
                            {filtered.map(p => (
                                <button key={p.id} onClick={() => {setSelectedId(p.id); setUserAngles({});}}
                                    className={`w-full text-left p-4 rounded-2xl transition-all ${selectedId === p.id ? 'bg-white shadow-lg border-l-4 border-indigo-500' : 'hover:bg-white/50'}`}>
                                    <div className="text-[8px] font-bold text-slate-400 uppercase">{p.category}</div>
                                    <div className="text-sm font-semibold text-slate-700">{p.name}</div>
                                </button>
                            ))}
                        </aside>

                        {/* CENTER: WORKSPACE */}
                        <section className="flex-1 space-y-8">
                            {/* View Switcher */}
                            <div className="flex gap-2 p-1 bg-slate-200/50 rounded-full w-fit">
                                {['biometrics', 'anatomy', 'protocol'].map(t => (
                                    <button key={t} onClick={() => setView(t)}
                                        className={`px-6 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all ${view === t ? 'tab-active shadow-md' : 'text-slate-500'}`}>
                                        {t}
                                    </button>
                                ))}
                            </div>

                            {/* Visualization Panel */}
                            <div className="glass-panel p-10 rounded-[3rem] aspect-video lg:aspect-auto lg:h-[500px] relative overflow-hidden flex items-center justify-center">
                                {view === 'biometrics' && <BiometricView pose={currentPose} userAngles={userAngles} />}
                                {view === 'anatomy' && <AnatomyView pose={currentPose} />}
                                {view === 'protocol' && (
                                    <div className="text-center max-w-2xl animate-in fade-in duration-700">
                                        <span className="text-6xl mb-6 block">‚Äú</span>
                                        <p className="text-4xl font-serif italic text-slate-800 leading-snug">{currentPose.instructions}</p>
                                    </div>
                                )}
                            </div>

                            {/* Breath Sync Bar */}
                            <div className="bg-indigo-600 p-8 rounded-[2.5rem] flex items-center justify-between text-white shadow-xl shadow-indigo-100">
                                <div className="flex items-center gap-6">
                                    <div className="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center breath-ring">
                                        <div className="w-3 h-3 rounded-full bg-white"></div>
                                    </div>
                                    <div>
                                        <span className="text-[9px] font-black uppercase tracking-widest opacity-60">Breath Control</span>
                                        <p className="text-xl font-serif italic">{currentPose.breath || "Regulated Ujjayi"}</p>
                                    </div>
                                </div>
                                <div className="hidden md:block h-px w-32 bg-white/20"></div>
                                <div className="text-right">
                                    <span className="text-[9px] font-black uppercase tracking-widest opacity-60">Sanskrit</span>
                                    <p className="text-xl font-serif italic">{currentPose.sanskrit}</p>
                                </div>
                            </div>
                        </section>

                        {/* RIGHT: CONTROLS */}
                        <aside className="w-full lg:w-96 space-y-6">
                            <div className="glass-panel p-8 rounded-[2.5rem]">
                                <h3 className="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-8 border-b pb-4">Alignment Checkpoints</h3>
                                <div className="space-y-8">
                                    {currentPose.checkpoints?.map(cp => {
                                        const currentVal = userAngles[cp.joint] || cp.ideal;
                                        const isOptimal = Math.abs(currentVal - cp.ideal) < 5;
                                        return (
                                            <div key={cp.joint}>
                                                <div className="flex justify-between items-end mb-4">
                                                    <span className="text-[10px] font-bold text-slate-500 uppercase">{cp.label}</span>
                                                    <span className={`font-mono text-xl ${isOptimal ? 'text-green-500' : 'text-indigo-500'}`}>{currentVal}¬∞</span>
                                                </div>
                                                <input 
                                                    type="range" min="0" max="180" 
                                                    value={currentVal}
                                                    onChange={e => setUserAngles({...userAngles, [cp.joint]: parseInt(e.target.value)})}
                                                    className="w-full"
                                                />
                                                <div className="flex justify-between text-[8px] font-black uppercase text-slate-300 mt-2">
                                                    <span>Target: {cp.ideal}¬∞</span>
                                                    <span>Range: {cp.range ? `${cp.range[0]}-${cp.range[1]}` : '--'}</span>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="glass-panel p-8 rounded-[2.5rem]">
                                <h3 className="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-4">Muscular Activation</h3>
                                <div className="flex flex-wrap gap-2">
                                    {currentPose.muscles?.map(m => (
                                        <span key={m} className="px-4 py-2 bg-white rounded-xl border border-slate-100 text-[10px] font-bold uppercase tracking-widest text-slate-600">{m}</span>
                                    ))}
                                </div>
                            </div>
                        </aside>
                    </main>
                </div>
            );
        }

        // --- SUB-COMPONENTS ---

        function BiometricView({ pose, userAngles }) {
            return (
                <div className="grid grid-cols-2 md:grid-cols-3 gap-12 animate-in zoom-in duration-500">
                    {pose.checkpoints?.map(cp => (
                        <div key={cp.joint} className="relative flex flex-col items-center">
                            <svg viewBox="0 0 100 100" className="w-32 h-32 transform -rotate-90">
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#e2e8f0" strokeWidth="2" />
                                <circle cx="50" cy="50" r="45" fill="none" stroke="#6366f1" strokeWidth="6" 
                                    strokeDasharray="283" strokeDashoffset={283 - (283 * (userAngles[cp.joint] || cp.ideal) / 180)}
                                    strokeLinecap="round" className="transition-all duration-500" />
                            </svg>
                            <div className="absolute inset-0 flex items-center justify-center pt-2">
                                <span className="font-mono text-2xl font-light">{userAngles[cp.joint] || cp.ideal}¬∞</span>
                            </div>
                            <span className="text-[8px] font-black uppercase text-slate-400 mt-4 text-center">{cp.label}</span>
                        </div>
                    ))}
                </div>
            );
        }

        function AnatomyView({ pose }) {
            return (
                <div className="flex flex-col items-center animate-in fade-in duration-500">
                    <div className="w-64 h-96 border-2 border-dashed border-slate-200 rounded-[3rem] flex items-center justify-center relative">
                        <div className="text-8xl opacity-20">üßç</div>
                        {pose.muscles?.map((m, i) => (
                            <div key={m} className="absolute p-2 bg-indigo-500 rounded-lg text-white text-[8px] font-bold uppercase"
                                 style={{ top: `${20 + (i*15)}%`, right: '-20px' }}>{m}</div>
                        ))}
                    </div>
                    <p className="mt-8 text-[10px] font-black uppercase tracking-[.3em] text-indigo-400">Biological mapping active</p>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MasterLab />);
    </script>
</body>
</html>
