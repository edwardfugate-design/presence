<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>presence • alignment lab</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500&family=Newsreader:ital,wght@0,300;0,400;1,400&display=swap" rel="stylesheet">
    
    <script src="yoga-v3.js"></script>

    <style>
        :root {
            --dawn-start: #f8f9fa;
            --text-present: #212529;
            --accent-focus: #6366f1;
            --accent-success: #84cc16;
            --accent-alert: #ef4444;
            --surface-primary: rgba(255, 255, 255, 0.6);
        }

        body { 
            font-family: 'JetBrains Mono', monospace; 
            background: #f1f3f5; 
            color: var(--text-present);
            line-height: 1.5;
        }
        
        .font-serif { font-family: 'Newsreader', serif; }

        /* Navigation & Cards */
        .filter-btn { transition: all 0.3s ease; border-bottom: 2px solid transparent; padding-bottom: 4px; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: #94a3b8; }
        .filter-btn.active { border-bottom-color: var(--accent-focus); color: var(--accent-focus); font-weight: 700; }
        
        .bio-card { 
            background: var(--surface-primary); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bio-card:hover { transform: translateY(-2px); border-color: var(--accent-focus); }

        /* Biometric Visuals */
        .pose-skeleton { stroke: rgba(73, 80, 87, 0.2); stroke-width: 2; fill: none; }
        .skeleton-joint { fill: var(--accent-focus); }
        .muscle-inactive { fill: rgba(139, 152, 165, 0.1); transition: fill 0.5s; }
        
        /* Custom Range Slider */
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 2px; background: #dee2e6; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: var(--text-present); border-radius: 50%; cursor: pointer; }

        .modal-overlay { background: rgba(248, 249, 250, 0.8); backdrop-filter: blur(12px); z-index: 100; position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; overflow-y: auto; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const MUSCLE_COLORS = {
            quadriceps: '#84cc16', hamstrings: '#6366f1', glutes: '#f59e0b',
            core: '#ef4444', shoulders: '#8b98a5', back: '#6366f1', calves: '#f59e0b'
        };

        function AlignmentLab() {
            const [search, setSearch] = useState('');
            const [activeCategory, setActiveCategory] = useState('All');
            const [selectedPose, setSelectedPose] = useState(null);
            const [angles, setAngles] = useState({});
            const [masterData, setMasterData] = useState([]);
            const [status, setStatus] = useState('loading');

            const categories = ['All', 'Standing', 'Backbend', 'Forward Fold', 'Twist', 'Hip Opener', 'Inversion'];

            useEffect(() => {
                const timer = setInterval(() => {
                    if (window.ALL_POSES && window.ALL_POSES.length > 0) {
                        setMasterData(window.ALL_POSES);
                        setStatus('ready');
                        clearInterval(timer);
                    }
                }, 300);
                return () => clearInterval(timer);
            }, []);

            // Handle angle initialization when a pose is selected
            useEffect(() => {
                if (selectedPose?.checkpoints) {
                    const initial = {};
                    selectedPose.checkpoints.forEach(cp => initial[cp.joint] = cp.ideal);
                    setAngles(initial);
                }
            }, [selectedPose]);

            const filteredData = useMemo(() => {
                return masterData.filter(p => {
                    const matchesSearch = p.name?.toLowerCase().includes(search.toLowerCase()) || 
                                         p.sanskrit?.toLowerCase().includes(search.toLowerCase());
                    const matchesCategory = activeCategory === 'All' || p.family === activeCategory;
                    return matchesSearch && matchesCategory;
                });
            }, [search, activeCategory, masterData]);

            const getAlignmentStatus = (joint, val) => {
                const cp = selectedPose.checkpoints.find(c => c.joint === joint);
                if (!cp) return 'optimal';
                if (val >= cp.range[0] && val <= cp.range[1]) return 'optimal';
                return Math.abs(val - cp.ideal) <= 15 ? 'acceptable' : 'misaligned';
            };

            if (status === 'loading') {
                return <div className="h-screen flex items-center justify-center font-serif italic text-2xl animate-pulse">Initializing Lab Matrix...</div>;
            }

            return (
                <div className="p-4 sm:p-8 max-w-7xl mx-auto min-h-screen">
                    <header className="mb-12">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 mb-8">
                            <div>
                                <h1 className="text-4xl sm:text-6xl font-serif tracking-tight">presence • lab</h1>
                                <p className="text-[10px] uppercase tracking-[0.3em] mt-2 text-slate-500 font-bold">Biomechanical Vault / {masterData.length} Units</p>
                            </div>
                            <input 
                                type="text" 
                                placeholder="Search Sanskrit or Common Name..." 
                                className="bg-white/50 border-b border-slate-300 py-2 outline-none focus:border-indigo-500 w-full md:w-64 text-sm"
                                onChange={(e) => setSearch(e.target.value)}
                            />
                        </div>
                        <nav className="flex gap-6 border-b border-slate-200 overflow-x-auto pb-2 no-scrollbar">
                            {categories.map(cat => (
                                <button key={cat} onClick={() => setActiveCategory(cat)} className={`filter-btn whitespace-nowrap ${activeCategory === cat ? 'active' : ''}`}>{cat}</button>
                            ))}
                        </nav>
                    </header>

                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        {filteredData.map(pose => (
                            <div key={pose.id} onClick={() => setSelectedPose(pose)} className="bio-card p-5 rounded-2xl cursor-pointer">
                                <span className="text-[9px] font-bold text-indigo-500 uppercase tracking-widest">{pose.family}</span>
                                <h3 className="text-lg font-serif mt-1">{pose.name}</h3>
                                <p className="text-xs italic text-slate-400 mb-4">{pose.sanskrit}</p>
                                <div className="flex justify-between items-center text-[10px] opacity-50">
                                    <span>Intensity {pose.intensity}/5</span>
                                    <span>#{pose.id}</span>
                                </div>
                            </div>
                        ))}
                    </div>

                    {selectedPose && (
                        <div className="modal-overlay p-4 sm:p-8" onClick={() => setSelectedPose(null)}>
                            <div className="bg-white rounded-[2rem] w-full max-w-6xl p-6 sm:p-10 shadow-2xl relative" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setSelectedPose(null)} className="absolute top-6 right-6 text-2xl">✕</button>
                                
                                <div className="grid lg:grid-cols-2 gap-12">
                                    {/* Left: Visualization */}
                                    <div>
                                        <span className="text-indigo-500 text-[10px] font-bold uppercase tracking-widest">Biomechanical Analysis</span>
                                        <h2 className="text-4xl font-serif mt-2">{selectedPose.name}</h2>
                                        
                                        <div className="mt-8 bg-slate-50 rounded-3xl p-4 aspect-square relative">
                                            {/* Stick Figure Skeleton */}
                                            <svg viewBox="0 0 400 500" className="w-full h-full">
                                                <g className="pose-skeleton">
                                                    <circle cx="200" cy="80" r="25" /> {/* Head */}
                                                    <line x1="200" y1="105" x2="200" y2="280" /> {/* Spine */}
                                                    <line x1="200" y1="130" x2="140" y2="200" /> {/* Arms */}
                                                    <line x1="200" y1="130" x2="260" y2="200" />
                                                    <line x1="200" y1="280" x2="160" y2="420" /> {/* Legs */}
                                                    <line x1="200" y1="280" x2="240" y2="420" />
                                                </g>
                                                {/* Joint Markers */}
                                                <circle cx="200" cy="130" r="5" className="skeleton-joint" />
                                                <circle cx="200" cy="280" r="5" className="skeleton-joint" />
                                                <circle cx="160" cy="420" r="5" className="skeleton-joint" />
                                                <circle cx="240" cy="420" r="5" className="skeleton-joint" />
                                            </svg>

                                            {/* Muscle Overlay Simulation */}
                                            <div className="absolute bottom-6 left-6 flex gap-2">
                                                {selectedPose.muscles?.map(m => (
                                                    <div key={m} className="flex items-center gap-1 bg-white px-2 py-1 rounded-full border border-slate-100 shadow-sm">
                                                        <div className="w-2 h-2 rounded-full" style={{background: MUSCLE_COLORS[m] || '#6366f1'}}></div>
                                                        <span className="text-[9px] uppercase font-bold">{m}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Right: Controls & Cues */}
                                    <div className="flex flex-col justify-center">
                                        <div className="space-y-8">
                                            <section>
                                                <h4 className="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-6">Joint Checkpoints</h4>
                                                <div className="space-y-6">
                                                    {selectedPose.checkpoints?.map(cp => {
                                                        const val = angles[cp.joint] || cp.ideal;
                                                        const status = getAlignmentStatus(cp.joint, val);
                                                        const color = status === 'optimal' ? '#84cc16' : status === 'acceptable' ? '#6366f1' : '#ef4444';
                                                        
                                                        return (
                                                            <div key={cp.joint}>
                                                                <div className="flex justify-between mb-2 items-end">
                                                                    <span className="text-xs font-medium">{cp.label}</span>
                                                                    <span className="text-lg font-mono" style={{color}}>{val}°</span>
                                                                </div>
                                                                <input 
                                                                    type="range" min="0" max="180" value={val} 
                                                                    onChange={(e) => setAngles({...angles, [cp.joint]: parseInt(e.target.value)})}
                                                                />
                                                                <div className="flex justify-between text-[9px] uppercase tracking-tighter mt-1 opacity-50">
                                                                    <span>Optimal Range: {cp.range[0]}° - {cp.range[1]}°</span>
                                                                    <span style={{color}}>{status}</span>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </section>

                                            <section className="bg-indigo-50/50 p-6 rounded-2xl">
                                                <h4 className="text-[10px] font-bold uppercase tracking-widest text-indigo-400 mb-3">Alignment Instructions</h4>
                                                <p className="text-sm font-serif italic leading-relaxed text-indigo-900">
                                                    {selectedPose.instructions || "Maintaining a neutral spine and active core is essential for stability in this posture. Focus on the breath."}
                                                </p>
                                            </section>

                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="p-4 border border-slate-100 rounded-xl">
                                                    <span className="text-[9px] uppercase text-slate-400 block mb-1">Primary Benefit</span>
                                                    <span className="text-xs font-bold">{selectedPose.benefits?.[0] || "Flexibility"}</span>
                                                </div>
                                                <div className="p-4 border border-slate-100 rounded-xl">
                                                    <span className="text-[9px] uppercase text-slate-400 block mb-1">Target Duration</span>
                                                    <span className="text-xs font-bold">{selectedPose.duration || 30} Seconds</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AlignmentLab />);
    </script>
</body>
</html>
