<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presence • Alignment Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="yoga-v3.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfd; color: #1e293b; }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .filter-btn { transition: all 0.3s ease; border-bottom: 2px solid transparent; padding-bottom: 8px; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; }
        .filter-btn.active { border-bottom-color: #4f46e5; color: #4f46e5; font-weight: 600; }
        .bio-card { background: white; border: 1px solid #eef2ff; border-radius: 1.5rem; transition: all 0.2s ease; cursor: pointer; padding: 2rem; }
        .bio-card:hover { border-color: #4f46e5; transform: translateY(-2px); shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); }
        .modal-overlay { background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(12px); z-index: 100; position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; padding: 1.5rem; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function AlignmentLab() {
            const [search, setSearch] = useState('');
            const [activeCategory, setActiveCategory] = useState('All');
            const [selectedPose, setSelectedPose] = useState(null);
            const [masterData, setMasterData] = useState([]);
            const [status, setStatus] = useState('loading');

            const categories = ['All', 'Standing', 'Floor', 'Core', 'Backbends'];

            useEffect(() => {
                const timer = setInterval(() => {
                    // Checks common variable names in your yoga-v3.js
                    const vault = window.POSE_LIBRARY || window.yogaData || window.ALL_POSES;
                    if (vault && vault.length > 0) {
                        setMasterData(vault);
                        setStatus('ready');
                        clearInterval(timer);
                    }
                }, 500);
                return () => clearInterval(timer);
            }, []);

            const filteredData = masterData.filter(p => {
                const matchesSearch = p.name?.toLowerCase().includes(search.toLowerCase()) || 
                                     p.sanskrit?.toLowerCase().includes(search.toLowerCase());
                const matchesCategory = activeCategory === 'All' || p.category === activeCategory;
                return matchesSearch && matchesCategory;
            });

            if (status === 'loading') {
                return <div className="h-screen flex items-center justify-center font-serif italic text-indigo-900 text-2xl animate-pulse">Synchronizing Vault...</div>;
            }

            return (
                <div className="p-8 max-w-6xl mx-auto min-h-screen">
                    <header className="mb-12">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-6 mb-8">
                            <div>
                                <h1 className="text-5xl font-serif text-slate-900">presence • lab</h1>
                                <p className="text-indigo-400 uppercase tracking-[0.3em] text-[9px] mt-2 font-black">
                                    Biometric Database • {masterData.length} Poses Indexed
                                </p>
                            </div>
                            <input 
                                type="text" 
                                placeholder="Search the vault..." 
                                className="bg-transparent border-b border-slate-200 py-2 outline-none focus:border-indigo-500 w-full md:w-64 italic transition-all"
                                onChange={(e) => setSearch(e.target.value)}
                            />
                        </div>

                        <div className="flex gap-8 border-b border-slate-100 overflow-x-auto">
                            {categories.map(cat => (
                                <button 
                                    key={cat}
                                    onClick={() => setActiveCategory(cat)}
                                    className={`filter-btn ${activeCategory === cat ? 'active' : ''}`}
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {filteredData.map(pose => (
                            <div key={pose.id} onClick={() => setSelectedPose(pose)} className="bio-card group">
                                <div className="flex justify-between items-start mb-4">
                                    <span className="text-[9px] font-bold text-indigo-500 bg-indigo-50 px-2 py-0.5 rounded uppercase">{pose.category}</span>
                                    <span className="text-[9px] text-slate-300 font-mono tracking-tighter">ID: {pose.id}</span>
                                </div>
                                <h3 className="text-2xl font-serif text-slate-800 group-hover:text-indigo-600 transition-colors">{pose.name}</h3>
                                <p className="text-sm italic text-slate-400 font-serif mb-6">{pose.sanskrit}</p>
                                <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Level: {pose.level}</div>
                            </div>
                        ))}
                    </div>

                    {filteredData.length === 0 && (
                        <div className="text-center py-20 text-slate-400 italic">No biometric matches found in this category.</div>
                    )}

                    {selectedPose && (
                        <div className="modal-overlay" onClick={() => setSelectedPose(null)}>
                            <div className="bg-white rounded-[3rem] max-w-2xl w-full max-h-[85vh] overflow-y-auto p-12 relative shadow-2xl" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setSelectedPose(null)} className="absolute top-10 right-10 text-slate-300 hover:text-slate-900 transition-colors">✕</button>
                                
                                <h2 className="text-4xl font-serif text-slate-900 mb-2">{selectedPose.name}</h2>
                                <p className="text-xl text-indigo-500 font-serif italic mb-10 border-b pb-6">{selectedPose.sanskrit}</p>
                                
                                <div className="grid md:grid-cols-2 gap-12">
                                    <section>
                                        <h4 className="text-[10px] font-black uppercase tracking-widest text-slate-900 mb-6 flex items-center gap-2">
                                            <span className="w-1.5 h-1.5 rounded-full bg-slate-900"></span> Anatomical Foundation
                                        </h4>
                                        <ul className="space-y-4 text-[13px] text-slate-600 leading-relaxed">
                                            {selectedPose.anatomy?.map((cue, i) => <li key={i} className="flex gap-2"><span>•</span> {cue}</li>)}
                                        </ul>
                                    </section>
                                    <section>
                                        <h4 className="text-[10px] font-black uppercase tracking-widest text-indigo-500 mb-6 flex items-center gap-2">
                                            <span className="w-1.5 h-1.5 rounded-full bg-indigo-500"></span> Subtle Body & Soul
                                        </h4>
                                        <ul className="space-y-4 text-[13px] text-slate-600 italic leading-relaxed">
                                            {selectedPose.mindfulness?.map((cue, i) => <li key={i} className="flex gap-2"><span>✧</span> {cue}</li>)}
                                        </ul>
                                    </section>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AlignmentLab />);
    </script>
</body>
</html>
