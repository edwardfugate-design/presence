<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>presence ‚Ä¢ movement breaks</title>
    <script src="presence-symphony-v2.js"></script>
    <script src="presence-content-manager.js"></script>
    <script src="presence-monitoring.js"></script>
    <script src="presence-auto-integrate.js"></script>
    <script src="all-libraries-compact.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --dawn-start: #f8f9fa; --dawn-mid: #e9ecef; --dawn-end: #dee2e6;
            --text-whisper: #6c757d; --text-soft: #495057; --text-present: #212529;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, var(--dawn-start) 0%, var(--dawn-mid) 50%, var(--dawn-end) 100%);
            min-height: 100vh; color: var(--text-soft);
        }
        .font-serif { font-family: 'Cormorant Garamond', serif; }
        .stat-label { font-size: 0.7rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--text-whisper); }
        .break-card {
            background: rgba(255,255,255,0.4); border: 1px solid rgba(0,0,0,0.05);
            backdrop-filter: blur(10px); transition: all 0.3s; cursor: pointer;
        }
        .break-card:hover { background: rgba(255,255,255,0.7); transform: translateY(-2px); }
        .pose-display {
            background: rgba(255,255,255,0.3); border: 2px solid rgba(139, 152, 165, 0.2);
            backdrop-filter: blur(10px); transition: all 0.5s;
        }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle {
            transition: stroke-dashoffset 1s linear;
            stroke: rgba(139, 152, 165, 0.5);
            stroke-width: 4;
        }
    </style>
</head>
<body>
    <div id="menuView" class="p-8 md:p-16 max-w-5xl mx-auto">
        <header class="mb-16">
            <a href="index.html" class="stat-label text-indigo-400 mb-4 block">‚Üê Hub</a>
            <h1 class="font-serif text-7xl tracking-tighter text-gray-900 mb-4">Movement Breaks</h1>
            <p class="text-lg text-gray-500 font-light">Quick resets for body and mind</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="break-card p-8 rounded-[2rem]" onclick="startBreak('quick')">
                <div class="stat-label mb-3">Quick Reset</div>
                <div class="text-3xl font-light text-gray-900 mb-2">2 minutes</div>
                <p class="text-sm text-gray-600">Instant relief for desk fatigue</p>
            </div>
            <div class="break-card p-8 rounded-[2rem]" onclick="startBreak('neck')">
                <div class="stat-label mb-3">Neck & Shoulders</div>
                <div class="text-3xl font-light text-gray-900 mb-2">3 minutes</div>
                <p class="text-sm text-gray-600">Release upper body tension</p>
            </div>
            <div class="break-card p-8 rounded-[2rem]" onclick="startBreak('posture')">
                <div class="stat-label mb-3">Posture Correction</div>
                <div class="text-3xl font-light text-gray-900 mb-2">4 minutes</div>
                <p class="text-sm text-gray-600">Counter forward slouching</p>
            </div>
            <div class="break-card p-8 rounded-[2rem]" onclick="startBreak('eyes')">
                <div class="stat-label mb-3">Eye Rest</div>
                <div class="text-3xl font-light text-gray-900 mb-2">2 minutes</div>
                <p class="text-sm text-gray-600">Reduce screen strain</p>
            </div>
            <div class="break-card p-8 rounded-[2rem]" onclick="startBreak('wrists')">
                <div class="stat-label mb-3">Wrist & Hands</div>
                <div class="text-3xl font-light text-gray-900 mb-2">3 minutes</div>
                <p class="text-sm text-gray-600">Prevent repetitive strain</p>
            </div>
            <div class="break-card p-8 rounded-[2rem]" onclick="startBreak('standing')">
                <div class="stat-label mb-3">Standing Flow</div>
                <div class="text-3xl font-light text-gray-900 mb-2">5 minutes</div>
                <p class="text-sm text-gray-600">Full body desk yoga</p>
            </div>
        </div>

        <div class="mt-12 bg-white/30 backdrop-blur-lg p-8 rounded-[2rem] border border-gray-100">
            <div class="flex items-center justify-between">
                <div>
                    <div class="stat-label mb-2">Auto Reminders</div>
                    <p class="text-sm text-gray-600">Get gentle nudges to move</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="reminderToggle" class="sr-only peer" onchange="toggleReminders()">
                    <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-gray-900"></div>
                </label>
            </div>
        </div>
    </div>

    <div id="breakView" class="hidden flex flex-col items-center justify-center min-h-screen p-8">
        <button onclick="endBreak()" class="stat-label text-indigo-400 mb-8 cursor-pointer">‚Üê End Break</button>
        <div class="pose-display p-12 rounded-[3rem] mb-8 max-w-lg w-full text-center">
            <div class="mb-8">
                <svg class="progress-ring mx-auto" width="120" height="120">
                    <circle class="text-gray-200" stroke-width="4" stroke="currentColor" fill="transparent" r="52" cx="60" cy="60"/>
                    <circle id="progressCircle" class="progress-ring-circle" stroke-width="4" fill="transparent" r="52" cx="60" cy="60"/>
                </svg>
            </div>
            <div class="text-5xl mb-4" id="poseEmoji">üßò</div>
            <h2 class="font-serif text-4xl text-gray-900 mb-4" id="poseName">Get Ready</h2>
            <p class="text-gray-600 leading-relaxed" id="poseInstruction">Preparing your break...</p>
        </div>
        <div class="text-center">
            <div class="stat-label mb-2" id="sequenceProgress">Step 1 of 5</div>
            <div class="text-sm text-gray-500" id="timeRemaining">0:00</div>
        </div>
    </div>

    <script>
        const BREAKS = {
            quick: {
                name: 'Quick Reset',
                poses: [
                    { name: 'Neck Rolls', instruction: 'Slowly roll your head in circles, 3 times each direction', duration: 30, emoji: 'üîÑ' },
                    { name: 'Shoulder Shrugs', instruction: 'Lift shoulders to ears, hold 3 seconds, release. Repeat 5 times', duration: 30, emoji: '‚¨ÜÔ∏è' },
                    { name: 'Seated Twist', instruction: 'Twist gently to each side, hold for 3 breaths', duration: 30, emoji: 'üåÄ' },
                    { name: 'Forward Fold', instruction: 'Stand and fold forward, let arms dangle. Relax', duration: 30, emoji: 'üôá' }
                ]
            },
            neck: {
                name: 'Neck & Shoulders',
                poses: [
                    { name: 'Ear to Shoulder', instruction: 'Tilt right ear toward right shoulder. Hold 20 seconds. Repeat left', duration: 45, emoji: 'üëÇ' },
                    { name: 'Neck Stretches', instruction: 'Look over right shoulder, hold. Repeat left', duration: 30, emoji: 'üëÄ' },
                    { name: 'Chin Tucks', instruction: 'Pull chin back, creating double chin. Hold 5 seconds. Repeat 10 times', duration: 45, emoji: 'üòê' },
                    { name: 'Shoulder Circles', instruction: 'Roll shoulders backwards 10 times, then forwards 10 times', duration: 40, emoji: '‚≠ï' }
                ]
            },
            posture: {
                name: 'Posture Correction',
                poses: [
                    { name: 'Wall Angels', instruction: 'Stand against wall, arms in "W" shape, slide up and down 10 times', duration: 60, emoji: 'üòá' },
                    { name: 'Doorway Stretch', instruction: 'Place forearms on doorframe, step forward, stretch chest', duration: 45, emoji: 'üö™' },
                    { name: 'Cat-Cow (Standing)', instruction: 'Hands on knees, arch and round spine slowly', duration: 45, emoji: 'üê±' },
                    { name: 'Chest Opener', instruction: 'Clasp hands behind back, straighten arms, lift chest', duration: 30, emoji: 'ü´Å' }
                ]
            },
            eyes: {
                name: 'Eye Rest',
                poses: [
                    { name: 'Palming', instruction: 'Rub hands together, cup over closed eyes, relax', duration: 30, emoji: 'üôà' },
                    { name: '20-20-20 Rule', instruction: 'Look at something 20 feet away for 20 seconds', duration: 20, emoji: 'üëÅÔ∏è' },
                    { name: 'Eye Circles', instruction: 'Look up, right, down, left in a circle. 5 times each direction', duration: 40, emoji: '‚≠ï' },
                    { name: 'Focus Shift', instruction: 'Hold finger close, focus on it. Then focus on distant object. Repeat 10 times', duration: 30, emoji: 'üëÜ' }
                ]
            },
            wrists: {
                name: 'Wrist & Hands',
                poses: [
                    { name: 'Wrist Circles', instruction: 'Rotate wrists in circles, 10 times each direction', duration: 30, emoji: '‚≠ï' },
                    { name: 'Prayer Stretch', instruction: 'Press palms together, lower hands until stretch felt', duration: 45, emoji: 'üôè' },
                    { name: 'Finger Pulls', instruction: 'Gently pull each finger back, hold 5 seconds each', duration: 60, emoji: '‚úã' },
                    { name: 'Fist Pumps', instruction: 'Make tight fist, hold 5 seconds, spread wide. Repeat 10 times', duration: 30, emoji: '‚úä' }
                ]
            },
            standing: {
                name: 'Standing Flow',
                poses: [
                    { name: 'Mountain Pose', instruction: 'Stand tall, feet hip-width, arms at sides, breathe deeply', duration: 30, emoji: 'üóª' },
                    { name: 'Forward Fold', instruction: 'Fold forward from hips, bend knees slightly, hang loose', duration: 40, emoji: 'üôá' },
                    { name: 'Half Lift', instruction: 'Lift torso parallel to floor, lengthen spine', duration: 30, emoji: 'üìè' },
                    { name: 'Standing Side Stretch', instruction: 'Reach right arm up and over to left. Hold. Switch sides', duration: 45, emoji: 'üåô' },
                    { name: 'Gentle Twist', instruction: 'Feet wide, twist torso to each side, arms swinging freely', duration: 45, emoji: 'üåÄ' },
                    { name: 'Tree Pose', instruction: 'Balance on one leg, place other foot on inner thigh or calf', duration: 30, emoji: 'üå≥' }
                ]
            }
        };

        // üéµ SYMPHONY: Enhance standing flow with real pose data if available
        if (window.PRESENCE?.POSES) {
            const mountainPose = window.PRESENCE.POSES.find(p => p.name === 'Mountain Pose');
            if (mountainPose) {
                BREAKS.standing.poses[0].instruction = mountainPose.cues?.[0] || BREAKS.standing.poses[0].instruction;
                console.log('üéµ Symphony: Enhanced standing flow with pose data');
            }
        }

        let currentBreak = null;
        let currentPoseIndex = 0;
        let timeRemaining = 0;
        let breakInterval = null;

        function startBreak(type) {
            currentBreak = BREAKS[type];
            currentPoseIndex = 0;
            document.getElementById('menuView').classList.add('hidden');
            document.getElementById('breakView').classList.remove('hidden');
            setTimeout(() => showPose(), 1000);
        }

        function showPose() {
            if (currentPoseIndex >= currentBreak.poses.length) {
                completeBreak();
                return;
            }
            const pose = currentBreak.poses[currentPoseIndex];
            document.getElementById('poseEmoji').textContent = pose.emoji;
            document.getElementById('poseName').textContent = pose.name;
            document.getElementById('poseInstruction').textContent = pose.instruction;
            document.getElementById('sequenceProgress').textContent =
                `Step ${currentPoseIndex + 1} of ${currentBreak.poses.length}`;
            timeRemaining = pose.duration;
            updateTimer();
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 52;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = circumference;
            breakInterval = setInterval(() => {
                timeRemaining--;
                updateTimer();
                const offset = circumference - (timeRemaining / pose.duration) * circumference;
                circle.style.strokeDashoffset = offset;
                if (timeRemaining <= 0) {
                    clearInterval(breakInterval);
                    currentPoseIndex++;
                    setTimeout(() => showPose(), 500);
                }
            }, 1000);
        }

        function updateTimer() {
            const mins = Math.floor(timeRemaining / 60);
            const secs = timeRemaining % 60;
            document.getElementById('timeRemaining').textContent =
                `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function completeBreak() {
            document.getElementById('poseEmoji').textContent = '‚ú®';
            document.getElementById('poseName').textContent = 'Complete!';
            document.getElementById('poseInstruction').textContent = 'Well done. Return to your work refreshed.';

            const totalDuration = currentBreak.poses.reduce((sum, p) => sum + p.duration, 0);
            const totalMins = Math.ceil(totalDuration / 60);

            // üéµ SYMPHONY: Use monitoring utility for consistent tracking
            if (window.PresenceMonitoring) {
                PresenceMonitoring.recordSession('movement', totalMins, {
                    breakType: currentBreak.name,
                    poses: currentBreak.poses.length
                });
            } else {
                const stored = parseInt(localStorage.getItem('totalPracticeMinutes') || '0');
                localStorage.setItem('totalPracticeMinutes', stored + totalMins);
            }

            setTimeout(() => endBreak(), 3000);
        }

        function endBreak() {
            clearInterval(breakInterval);
            document.getElementById('menuView').classList.remove('hidden');
            document.getElementById('breakView').classList.add('hidden');
            currentBreak = null;
        }

        function toggleReminders() {
            const enabled = document.getElementById('reminderToggle').checked;
            localStorage.setItem('movement_reminders', enabled);
            if (enabled) {
                alert('Reminders enabled! You\'ll get a gentle nudge every hour to take a movement break.');
            }
        }

        const remindersEnabled = localStorage.getItem('movement_reminders') === 'true';
        document.getElementById('reminderToggle').checked = remindersEnabled;
    </script>
</body>
</html>
